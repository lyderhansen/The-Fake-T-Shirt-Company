##############################################################################################################
#
# transforms.conf for Demo Environment
#
# Host extraction and field extraction transforms for :demo sourcetypes
#
##############################################################################################################


##############################################################################################################
# HOST EXTRACTION
##############################################################################################################

# Extract host from demo_host field (Windows Perfmon)
# Matches: demo_host=HOSTNAME
[host_from_demo_field]
REGEX=demo_host=(\S+)
DEST_KEY = MetaData:Host
FORMAT = host::$1

[FAKE_st_perfmon_network_interface]
REGEX = object=Network(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::FAKE:Perfmon:Network_Interface

[FAKE_st_perfmon_generic_object]
REGEX = object=(LogicalDisk|Memory|Processor)(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::FAKE:Perfmon:$1



# Extract host from Linux log format
# Format: YYYY-MM-DD HH:MM:SS hostname rest_of_log
# Example: 2026-01-01 12:34:56 WEB-01 CPU all 25.00 ...
[set_host_from_linux_fake]
#REGEX = ^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}\s(\S+)
REGEX = ^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}\shost=(.+?)\s
DEST_KEY = MetaData:Host
FORMAT = host::$1


[set_host_from_asa_syslog_fake]
#REGEX = ^\w{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}\s+(\S+)\s+%ASA
#REGEX = ^\<\d+?\>\w{3}\s+\d{1,2}\s+\d+\s+\d{2}:\d{2}:\d{2}\.\d{3}\s+(\S+)\s+%ASA
REGEX = \w{3}\s+\d{1,2}\s+\d+\s+\d{2}:\d{2}:\d{2}\.\d{3}\s+(\S+)\s+%ASA
DEST_KEY = MetaData:Host
FORMAT = host::$1

[set_host_from_wineventlog]
REGEX=ComputerName=(.*)\n
DEST_KEY = MetaData:Host
FORMAT = host::$1




##############################################################################################################
# WINDOWS PERFMON FIELD EXTRACTIONS
##############################################################################################################

# Perfmon:Processor fields
# Format: MM/DD/YYYY HH:MM:SS demo_host=HOST object=Processor counter="% Processor Time" instance=_Total value=XX.XX
[extract_perfmon_processor_fields]
REGEX = object=Processor\s+counter="?([^"]+)"?\s+instance=(\S+)\s+value=([\d.]+)
FORMAT = counter::$1 instance::$2 value::$3

# Perfmon:Memory fields
# Format: MM/DD/YYYY HH:MM:SS demo_host=HOST object=Memory counter="Available MBytes" value=XXXX
[extract_perfmon_memory_fields]
REGEX = object=Memory\s+counter="?([^"]+)"?\s+(?:instance=(\S+)\s+)?value=([\d.]+)
FORMAT = counter::$1 instance::$2 value::$3

# Perfmon:LogicalDisk fields
# Format: MM/DD/YYYY HH:MM:SS demo_host=HOST object=LogicalDisk counter="% Free Space" instance=C: value=XX.XX
[extract_perfmon_disk_fields]
REGEX = object=LogicalDisk\s+counter="?([^"]+)"?\s+instance=(\S+)\s+value=([\d.]+)
FORMAT = counter::$1 instance::$2 value::$3

# Perfmon:Network_Interface fields
# Format: MM/DD/YYYY HH:MM:SS demo_host=HOST object=Network Interface counter="Bytes Total/sec" instance=Intel... value=XXXX
[extract_perfmon_network_fields]
REGEX = object=Network(?:\s+Interface)?\s+counter="?([^"]+)"?\s+instance="?([^"]+)"?\s+value=([\d.]+)
FORMAT = counter::$1 instance::$2 value::$3


##############################################################################################################
# LINUX METRICS FIELD EXTRACTIONS
##############################################################################################################

# Linux cpu fields (sar-style)
# Format: 2026-01-01 12:34:56 WEB-01 CPU all 25.00 0.00 10.00 5.00 0.00 60.00
# Fields: timestamp hostname CPU cpu_instance pctUser pctNice pctSystem pctIowait pctSteal pctIdle
[extract_linux_cpu_fields]
REGEX = CPU\s+(\S+)\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)\s+([\d.]+)
FORMAT = cpu_instance::$1 pctUser::$2 pctNice::$3 pctSystem::$4 pctIowait::$5 pctSteal::$6 pctIdle::$7

# Linux vmstat fields
# Format: 2026-01-01 12:34:56 WEB-01 procs r=1 b=0 memory swpd=0 free=12345 buff=12345 cache=12345
[extract_linux_vmstat_fields]
REGEX = procs\s+r=(\d+)\s+b=(\d+)\s+memory\s+swpd=(\d+)\s+free=(\d+)\s+buff=(\d+)\s+cache=(\d+)
FORMAT = procs_r::$1 procs_b::$2 swpd::$3 memFree::$4 buff::$5 cache::$6

# Linux df fields
# Format: 2026-01-01 12:34:56 WEB-01 Filesystem=/dev/sda1 Size=100G Used=50G Avail=50G UsePct=50% MountedOn=/
[extract_linux_df_fields]
REGEX = Filesystem=(\S+)\s+Size=(\S+)\s+Used=(\S+)\s+Avail=(\S+)\s+UsePct=(\S+)\s+MountedOn=(\S+)
FORMAT = Filesystem::$1 Size::$2 Used::$3 Avail::$4 UsePct::$5 MountedOn::$6

# Linux iostat fields
# Format: 2026-01-01 12:34:56 WEB-01 Device=sda rrqm/s=0.00 wrqm/s=0.00 r/s=10.00 w/s=5.00 %util=15.00
[extract_linux_iostat_fields]
REGEX = Device=(\S+)\s+rrqm/s=([\d.]+)\s+wrqm/s=([\d.]+)\s+r/s=([\d.]+)\s+w/s=([\d.]+)\s+%util=([\d.]+)
FORMAT = Device::$1 rrqm_s::$2 wrqm_s::$3 r_s::$4 w_s::$5 util::$6

# Linux interfaces fields
# Format: 2026-01-01 12:34:56 WEB-01 Iface=eth0 rxBytes=12345 txBytes=12345 rxPackets=123 txPackets=123
[extract_linux_interfaces_fields]
REGEX = Iface=(\S+)\s+rxBytes=(\d+)\s+txBytes=(\d+)\s+rxPackets=(\d+)\s+txPackets=(\d+)
FORMAT = Iface::$1 rxBytes::$2 txBytes::$3 rxPackets::$4 txPackets::$5


##############################################################################################################
# WEB ACCESS LOG FIELD EXTRACTIONS
##############################################################################################################

# Apache Combined Log Format
# Format: 10.0.5.20 - - [15/Jan/2026:12:34:56 +0000] "GET /api/users HTTP/1.1" 200 1234 "-" "Mozilla/5.0"
[extract_access_combined_fields]
REGEX = ^(\S+)\s+(\S+)\s+(\S+)\s+\[[^\]]+\]\s+"(\S+)\s+(\S+)\s+(\S+)"\s+(\d+)\s+(\d+)\s+"([^"]*)"\s+"([^"]*)"
FORMAT = clientip::$1 ident::$2 user::$3 method::$4 uri::$5 http_version::$6 status::$7 bytes::$8 referer::$9 useragent::$10


##############################################################################################################
# SOURCETYPE ROUTING (optional - for generic Perfmon input)
##############################################################################################################

# Route Perfmon events to specific sourcetypes based on object field
[route_perfmon_processor]
REGEX = object=Processor(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::Perfmon:Processor:demo

[route_perfmon_memory]
REGEX = object=Memory(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::Perfmon:Memory:demo

[route_perfmon_logicaldisk]
REGEX = object=LogicalDisk(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::Perfmon:LogicalDisk:demo

[route_perfmon_network]
REGEX = object=Network(\s|$)
DEST_KEY = MetaData:Sourcetype
FORMAT = sourcetype::Perfmon:Network_Interface:demo

[customer_lookup]
batch_index_query = 0
case_sensitive_match = 1
filename = customer_lookup.csv


##############################################################################################################
# O365 exchange
##############################################################################################################


[extract_messagetrace_src_user_domain_demo]
SOURCE_KEY = SenderAddress
REGEX = @(?<src_user_domain>\S*)

[extract_messagetrace_recipient_domain_demo]
SOURCE_KEY = RecipientAddress
REGEX = @(?<recipient_domain>\S*)

##############################################################################################################
#GCP
##############################################################################################################

[gcp_pubsub_activity_sourcetype_demo]
REGEX = \"logName":\s*?"[a-z\-\/0-9]*?cloudaudit\.googleapis\.com%2Factivity"
FORMAT = sourcetype::FAKE:google:gcp:pubsub:audit:admin_activity:demo
DEST_KEY = MetaData:Sourcetype

[gcp_pubsub_data_access_sourcetype_demo]
REGEX = \"logName":\s*?"[a-z\-\/0-9]*?cloudaudit\.googleapis\.com%2Fdata_access"
FORMAT = sourcetype::FAKE:google:gcp:pubsub:audit:data_access:demo
DEST_KEY = MetaData:Sourcetype

[set_host_from_gcp_project]
REGEX = \"project_id\": \"([\w\-\s]+)\",
DEST_KEY = MetaData:Host
FORMAT = host::$1


##############################################################################################################
#Meraki
##############################################################################################################

[set_meraki_host_from_devicename]
REGEX = \"deviceName\": \"([\w\-\s]+)\",
DEST_KEY = MetaData:Host
FORMAT = host::$1