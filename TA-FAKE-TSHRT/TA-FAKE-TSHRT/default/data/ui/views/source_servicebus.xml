<dashboard version="1.1" theme="dark">
  <label>Azure ServiceBus</label>
  <description>Order processing messages from Azure ServiceBus</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #1f2d2d 100%); border-radius: 8px; border-left: 4px solid #0078d4;">
          <h2 style="color: #0078d4; margin-top: 0;">Azure ServiceBus</h2>
          <p style="color: #ccc; font-size: 1.1em;">Order processing messages showing the order fulfillment pipeline from placement through delivery.</p>
          <div style="display: flex; gap: 30px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Sourcetype:</span> <code style="color: #5CC05C;">FAKE:azure:servicebus</code>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Format:</span> <strong style="color: #fff;">JSON</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Queue:</span> <strong style="color: #fff;">order-processing</strong>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Messages Over Time</title>
      <chart>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:azure:servicebus" by _time span=1h</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"count": 0x0078d4}</option>
      </chart>
    </panel>
    <panel>
      <title>Messages by Status</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| stats count by status
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Total Messages</title>
      <single>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:azure:servicebus"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x0078d4","0x0078d4"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Unique Orders</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus" | stats dc(order_id)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0x5CC05C"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Completed Orders</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus" status=delivered | stats dc(order_id)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0x5CC05C"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Failed Messages</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus" (status=failed OR status=error) | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Order Pipeline</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <h4 style="color: #0078d4; margin-top: 0;">Order Fulfillment Stages</h4>
          <div style="display: flex; justify-content: space-between; align-items: center; margin: 20px 0; flex-wrap: wrap;">
            <div style="text-align: center; flex: 1; min-width: 80px;">
              <div style="background: #5CC05C; color: #000; padding: 8px; border-radius: 5px;">received</div>
            </div>
            <div style="color: #444;">→</div>
            <div style="text-align: center; flex: 1; min-width: 80px;">
              <div style="background: #f8be34; color: #000; padding: 8px; border-radius: 5px;">processing</div>
            </div>
            <div style="color: #444;">→</div>
            <div style="text-align: center; flex: 1; min-width: 80px;">
              <div style="background: #f8be34; color: #000; padding: 8px; border-radius: 5px;">picking</div>
            </div>
            <div style="color: #444;">→</div>
            <div style="text-align: center; flex: 1; min-width: 80px;">
              <div style="background: #0877a6; color: #fff; padding: 8px; border-radius: 5px;">shipped</div>
            </div>
            <div style="color: #444;">→</div>
            <div style="text-align: center; flex: 1; min-width: 80px;">
              <div style="background: #5CC05C; color: #000; padding: 8px; border-radius: 5px;">delivered</div>
            </div>
          </div>
        </div>
      </html>
    </panel>
    <panel>
      <title>Key Fields</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Field</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Description</th>
            </tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">order_id</td><td style="padding: 8px; border: 1px solid #444;">Order identifier</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">message_id</td><td style="padding: 8px; border: 1px solid #444;">ServiceBus message ID</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">status</td><td style="padding: 8px; border: 1px solid #444;">Processing stage</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">queue_name</td><td style="padding: 8px; border: 1px solid #444;">ServiceBus queue</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">enqueued_time</td><td style="padding: 8px; border: 1px solid #444;">Message enqueue time</td></tr>
          </table>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Messages by Status</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| stats count by status
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Order Journey</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| stats count, earliest(_time) AS first_event, latest(_time) AS last_event by order_id
| eval first_event=strftime(first_event, "%Y-%m-%d %H:%M"), last_event=strftime(last_event, "%Y-%m-%d %H:%M")
| sort - count
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Use Cases</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #5CC05C; margin-top: 0;">Common SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">Order Flow</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| transaction order_id
| table order_id, eventcount, duration, status</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Processing Time</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| transaction order_id
| eval processing_hours=duration/3600
| stats avg(processing_hours) AS avg_hours, max(processing_hours) AS max_hours</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Stage Distribution</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| timechart span=1d count by status</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Stuck Orders</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| stats latest(status) AS current_status, latest(_time) AS last_update by order_id
| where current_status!="delivered"
| eval hours_since_update=round((now()-last_update)/3600,1)
| where hours_since_update > 24</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Sample Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:servicebus"
| table _time, order_id, message_id, status, queue_name
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
