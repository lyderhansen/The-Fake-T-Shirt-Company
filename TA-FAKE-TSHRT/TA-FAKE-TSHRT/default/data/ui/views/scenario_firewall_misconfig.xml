<dashboard version="1.1" theme="dark">
  <label>Firewall Misconfig - ACL Error</label>
  <description>2-hour outage caused by accidental ACL blocking inbound HTTPS</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #1f1f2d 100%); border-radius: 8px; border-left: 4px solid #0877a6;">
          <h2 style="color: #0877a6; margin-top: 0;">Firewall Misconfiguration - ACL Error</h2>
          <p style="color: #ccc; font-size: 1.1em;">IT admin attempts to block a threat IP but accidentally blocks inbound traffic TO the web server's public IP, causing a 2-hour customer-facing outage.</p>
          <div style="display: flex; gap: 30px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Duration:</span> <strong style="color: #fff;">2 hours</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Category:</span> <strong style="color: #0877a6;">Network</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">demo_id:</span> <code style="color: #5CC05C;">firewall_misconfig</code>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Impact:</span> <strong style="color: #dc4e41;">Complete website outage</strong>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Incident Timeline - Day 7</title>
      <html>
        <div style="padding: 15px; background: #1a1a1a; border-radius: 5px;">
          <div style="display: flex; justify-content: space-between; align-items: center; overflow-x: auto; padding: 20px 0;">
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #0877a6; color: #fff; padding: 10px; border-radius: 5px; font-weight: bold;">10:15</div>
              <div style="color: #ccc; margin-top: 10px;">Admin<br/>Login</div>
            </div>
            <div style="color: #444; font-size: 2em;">→</div>
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #f8be34; color: #000; padding: 10px; border-radius: 5px; font-weight: bold;">10:16</div>
              <div style="color: #ccc; margin-top: 10px;">Config<br/>Mode</div>
            </div>
            <div style="color: #444; font-size: 2em;">→</div>
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #dc4e41; color: #fff; padding: 10px; border-radius: 5px; font-weight: bold;">10:18</div>
              <div style="color: #ccc; margin-top: 10px;">Bad ACL<br/>Applied</div>
            </div>
            <div style="color: #444; font-size: 2em;">→</div>
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #dc4e41; color: #fff; padding: 10px; border-radius: 5px; font-weight: bold;">10:20<br/>-12:00</div>
              <div style="color: #ccc; margin-top: 10px;">OUTAGE<br/>~95 denies</div>
            </div>
            <div style="color: #444; font-size: 2em;">→</div>
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #5CC05C; color: #000; padding: 10px; border-radius: 5px; font-weight: bold;">12:03</div>
              <div style="color: #ccc; margin-top: 10px;">Rollback</div>
            </div>
            <div style="color: #444; font-size: 2em;">→</div>
            <div style="text-align: center; min-width: 100px;">
              <div style="background: #5CC05C; color: #000; padding: 10px; border-radius: 5px; font-weight: bold;">12:05</div>
              <div style="color: #ccc; margin-top: 10px;">Admin<br/>Logout</div>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Admin Who Made the Mistake</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px; border-left: 4px solid #f8be34;">
          <h3 style="color: #f8be34; margin-top: 0;">network.admin</h3>
          <table style="width: 100%;">
            <tr><td style="color: #999; padding: 5px 0; width: 120px;">Username:</td><td style="color: #fff;"><strong>network.admin</strong></td></tr>
            <tr><td style="color: #999; padding: 5px 0;">Source IP:</td><td style="color: #5CC05C;">10.10.10.50</td></tr>
            <tr><td style="color: #999; padding: 5px 0;">Action:</td><td style="color: #dc4e41;">Mistyped ACL rule</td></tr>
          </table>
        </div>
      </html>
    </panel>
    <panel>
      <title>Affected Target</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px; border-left: 4px solid #dc4e41;">
          <h3 style="color: #dc4e41; margin-top: 0;">WEB-01</h3>
          <table style="width: 100%;">
            <tr><td style="color: #999; padding: 5px 0; width: 120px;">Server:</td><td style="color: #fff;"><strong>WEB-01</strong></td></tr>
            <tr><td style="color: #999; padding: 5px 0;">Public IP:</td><td style="color: #dc4e41;">203.0.113.10</td></tr>
            <tr><td style="color: #999; padding: 5px 0;">Ports:</td><td style="color: #fff;">80, 443</td></tr>
          </table>
        </div>
      </html>
    </panel>
    <panel>
      <title>The Mistake</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px; border-left: 4px solid #dc4e41;">
          <h4 style="color: #5CC05C; margin-top: 0;">Intended Action</h4>
          <p style="color: #ccc;">Block traffic FROM threat actor IP</p>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; color: #5CC05C; font-size: 0.9em;">access-list outside_access_in deny tcp host 185.220.101.42 any</pre>

          <h4 style="color: #dc4e41; margin-top: 15px;">Actual Action</h4>
          <p style="color: #ccc;">Block traffic TO web server public IP</p>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; color: #dc4e41; font-size: 0.9em;">access-list outside_access_in deny tcp any host 203.0.113.10 eq https</pre>

          <p style="color: #dc4e41; margin-top: 15px;"><strong>Result:</strong> All customer HTTPS traffic blocked!</p>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Blocked Connections Over Time</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" "%ASA-4-106023" dest=203.0.113.10 demo_id=firewall_misconfig
| timechart span=5m count AS "Blocked Connections"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"Blocked Connections": 0xdc4e41}</option>
      </chart>
    </panel>
    <panel>
      <title>Events by Type</title>
      <chart>
        <search>
          <query>index=fake_tshrt demo_id=firewall_misconfig
| stats count by sourcetype
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Total Blocked</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" "%ASA-4-106023" dest=203.0.113.10 demo_id=firewall_misconfig | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Unique Customers Affected</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" "%ASA-4-106023" demo_id=firewall_misconfig | stats dc(src) AS unique_customers</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xf8be34","0xf8be34"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Outage Duration</title>
      <single>
        <search>
          <query>| makeresults | eval duration="~2 hours" | table duration</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Time to Fix</title>
      <single>
        <search>
          <query>| makeresults | eval fix="3 min" | table fix</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0x5CC05C"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Deny Event Volumes by Time Window</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Time Window</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Deny Events</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Description</th>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444;">10:20-10:59</td>
              <td style="padding: 8px; border: 1px solid #444;">~30</td>
              <td style="padding: 8px; border: 1px solid #444;">Initial wave</td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444;">11:00-11:59</td>
              <td style="padding: 8px; border: 1px solid #444; color: #dc4e41;"><strong>~60</strong></td>
              <td style="padding: 8px; border: 1px solid #444; color: #dc4e41;"><strong>Peak (customer retries)</strong></td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444;">12:00-12:02</td>
              <td style="padding: 8px; border: 1px solid #444;">~5</td>
              <td style="padding: 8px; border: 1px solid #444;">Final denies before fix</td>
            </tr>
            <tr style="background: #2a2a2a;">
              <td style="padding: 8px; border: 1px solid #444;"><strong>Total</strong></td>
              <td style="padding: 8px; border: 1px solid #444; color: #dc4e41;"><strong>~95</strong></td>
              <td style="padding: 8px; border: 1px solid #444;"><strong>All blocked connections</strong></td>
            </tr>
          </table>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Admin Activity Log</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" user="network.admin" demo_id=firewall_misconfig
| sort _time
| table _time, message</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>ASA Message Types</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Message Code</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Meaning</th>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">%ASA-6-605005</td>
              <td style="padding: 8px; border: 1px solid #444;">Login permitted - Admin login</td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444; color: #f8be34;">%ASA-5-111008</td>
              <td style="padding: 8px; border: 1px solid #444;">executed 'configure terminal' - Config mode</td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444; color: #dc4e41;">%ASA-5-111010</td>
              <td style="padding: 8px; border: 1px solid #444;">executed 'access-list...' - Rule change</td>
            </tr>
            <tr>
              <td style="padding: 8px; border: 1px solid #444; color: #dc4e41;">%ASA-4-106023</td>
              <td style="padding: 8px; border: 1px solid #444;">Denied by access-list - Blocked traffic</td>
            </tr>
          </table>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Investigation Queries</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #5CC05C; margin-top: 0;">Ready-to-Use SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">Full Incident Timeline</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:cisco:asa" demo_id=firewall_misconfig
| sort _time
| table _time, action, message</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Config Changes Only</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:cisco:asa"
  ("%ASA-5-111008" OR "%ASA-5-111010") demo_id=firewall_misconfig
| table _time, message</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Deny Events Over Time</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:cisco:asa"
  "%ASA-4-106023" demo_id=firewall_misconfig
| timechart span=5m count AS "Blocked Connections"</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Impact Assessment</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:cisco:asa"
  "%ASA-4-106023" demo_id=firewall_misconfig
| stats count AS blocked_connections, dc(src) AS unique_customers</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Compare to Normal Traffic</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:cisco:asa" dest=203.0.113.10
| eval status=if(action="deny", "Blocked", "Allowed")
| timechart span=15m count by status</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Recent Firewall Misconfig Events</title>
      <table>
        <search>
          <query>index=fake_tshrt demo_id=firewall_misconfig
| sort - _time
| table _time, sourcetype, host, user, src, dest, action, message
| head 50</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">20</option>
      </table>
    </panel>
  </row>
</dashboard>
