# REST API endpoints for TA-FAKE-TSHRT admin functions
#
# Endpoints:
#   GET/POST /services/ta_fake_tshrt/generate  - Generate demo logs
#   GET/POST /services/ta_fake_tshrt/delete    - Delete and recreate index

# ============================================================================
# Log Generator Endpoint
# ============================================================================
# Uses PersistentServerConnectionApplication for proper GET/POST support.
#
# GET:  Returns available options and current status
# POST: Deletes old log files and runs main_generate.py
#
# POST Parameters:
#   sources              - Comma-separated list of sources (default: "all")
#   days                 - Number of days to generate (default: "14")
#   scenarios            - Scenario to include (default: "exfil")
#   start_date           - Start date YYYY-MM-DD (default: "2026-01-01")
#   scale                - Volume scale factor (default: "1.0")
#   clients              - Number of perfmon clients (default: "5")
#   client_interval      - Minutes between client metrics (default: "30")
#   full_metrics         - Include disk/network for clients (default: "false")
#   orders_per_day       - Target orders per day (default: "224")
#   meraki_health_interval - Minutes between health samples (default: "5")
#   no_mr_health         - Disable MR health (default: "false")
#   no_ms_health         - Disable MS health (default: "false")
#   parallel             - Number of parallel workers (default: "4")
#   clean_only           - Only delete files, don't generate (default: "false")
#
# Example:
#   curl -k -u admin:password -X POST \
#     "https://localhost:8089/services/ta_fake_tshrt/generate" \
#     -d "sources=asa,entraid" -d "days=7" -d "scenarios=exfil"

[script:ta_fake_tshrt_generate]
match = /ta_fake_tshrt/generate
script = generate_logs.py
scripttype = persist
handler = generate_logs.GenerateHandler
requireAuthentication = true
output_modes = json
passPayload = true
passHttpHeaders = true
passHttpCookies = true
python.version = python3


# ============================================================================
# Index Delete/Recreate Endpoint
# ============================================================================
# Uses PersistentServerConnectionApplication for proper GET/POST support.
#
# GET:  Returns current index status
# POST: Deletes the fake_tshrt index and recreates it (frees disk space)
#
# POST Parameters:
#   confirm     - Must be "true" to execute (safety check)
#   skip_inputs - If "true", don't disable/enable inputs (default: "false")
#
# Example:
#   curl -k -u admin:password -X POST \
#     "https://localhost:8089/services/ta_fake_tshrt/delete" \
#     -d "confirm=true"

[script:ta_fake_tshrt_delete]
match = /ta_fake_tshrt/delete
script = delete_index.py
scripttype = persist
handler = delete_index.DeleteIndexHandler
requireAuthentication = true
output_modes = json
passPayload = true
passHttpHeaders = true
passHttpCookies = true
python.version = python3
