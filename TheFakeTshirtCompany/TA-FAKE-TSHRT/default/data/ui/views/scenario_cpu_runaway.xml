<dashboard version="2" theme="dark">
  <label>Scenario - CPU Runaway</label>
  <description>SQL backup job stuck at 100% CPU — 32-hour escalation from backup start to manual DBA intervention</description>
  <definition><![CDATA[
{
  "title": "Scenario - CPU Runaway",
  "description": "SQL backup job stuck at 100% CPU — 32-hour escalation from backup start to manual DBA intervention",
  "dataSources": {
    "ds_total_events": {
      "type": "ds.search",
      "name": "Total CPU Runaway Scenario Events Over Time",
      "options": {
        "query": "| tstats count where index=fake_tshrt IDX_demo_id=cpu_runaway by _time span=1h"
      }
    },
    "ds_affected_sourcetypes": {
      "type": "ds.search",
      "name": "Affected Sourcetype Count",
      "options": {
        "query": "| tstats dc(sourcetype) as count where index=fake_tshrt IDX_demo_id=cpu_runaway"
      }
    },
    "ds_affected_hosts": {
      "type": "ds.search",
      "name": "Affected Host Count",
      "options": {
        "query": "| tstats dc(host) as count where index=fake_tshrt IDX_demo_id=cpu_runaway"
      }
    },
    "ds_peak_cpu": {
      "type": "ds.search",
      "name": "Peak CPU Usage",
      "options": {
        "query": "index=fake_tshrt (sourcetype=\"FAKE:Perfmon:Processor\" OR (sourcetype=\"FAKE:Perfmon:Generic\" object=Processor)) counter=\"% Processor Time\" instance=_Total host=SQL-PROD-01 | stats max(value) as count | eval count=round(count, 0) | fields count"
      }
    },
    "ds_cpu_timeline": {
      "type": "ds.search",
      "name": "CPU Usage Over Time (SQL-PROD-01)",
      "options": {
        "query": "index=fake_tshrt (sourcetype=\"FAKE:Perfmon:Processor\" OR (sourcetype=\"FAKE:Perfmon:Generic\" object=Processor)) counter=\"% Processor Time\" instance=_Total host=SQL-PROD-01 | timechart span=1h avg(value) as \"% CPU\""
      }
    },
    "ds_memory_timeline": {
      "type": "ds.search",
      "name": "Memory Usage Over Time (SQL-PROD-01)",
      "options": {
        "query": "index=fake_tshrt (sourcetype=\"FAKE:Perfmon:Memory\" OR (sourcetype=\"FAKE:Perfmon:Generic\" object=Memory)) counter=\"Available MBytes\" host=SQL-PROD-01 | timechart span=1h avg(value) as \"Available MBytes\""
      }
    },
    "ds_cross_source": {
      "type": "ds.search",
      "name": "Scenario Events by Source Over Time",
      "options": {
        "query": "index=fake_tshrt demo_id=cpu_runaway | eval source_label=case(match(sourcetype,\"Perfmon\"), \"Perfmon\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"cisco:asa\"), \"ASA Firewall\", match(sourcetype,\"access_combined\"), \"Apache Access\", 1=1, sourcetype) | timechart span=1h count by source_label"
      }
    },
    "ds_events_by_source": {
      "type": "ds.search",
      "name": "Events by Source Type",
      "options": {
        "query": "index=fake_tshrt demo_id=cpu_runaway | eval source_label=case(match(sourcetype,\"Perfmon\"), \"Perfmon\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"cisco:asa\"), \"ASA Firewall\", match(sourcetype,\"access_combined\"), \"Apache Access\", 1=1, sourcetype) | stats count by source_label | sort -count"
      }
    },
    "ds_sql_events": {
      "type": "ds.search",
      "name": "SQL Server Windows Events",
      "options": {
        "query": "index=fake_tshrt sourcetype=\"FAKE:WinEventLog\" demo_id=cpu_runaway host=SQL-PROD-01 | eval event_detail=coalesce(EventCode, \"unknown\") | table _time host event_detail Message | sort _time | head 30 | rename event_detail as \"EventCode\" Message as \"Description\""
      }
    },
    "ds_http_errors": {
      "type": "ds.search",
      "name": "HTTP Error Rate Over Time",
      "options": {
        "query": "index=fake_tshrt sourcetype=\"FAKE:access_combined\" | eval is_error=if(status>=500, 1, 0) | timechart span=1h avg(is_error) as error_rate | eval error_rate=round(error_rate*100, 1)"
      }
    },
    "ds_key_evidence": {
      "type": "ds.search",
      "name": "Key Evidence Timeline",
      "options": {
        "query": "index=fake_tshrt demo_id=cpu_runaway | eval evidence=coalesce(counter, action, EventCode, status, \"event\") | eval source_label=case(match(sourcetype,\"Perfmon\"), \"Perfmon\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"cisco:asa\"), \"ASA\", match(sourcetype,\"access_combined\"), \"Apache\", 1=1, sourcetype) | table _time source_label host evidence | sort -_time | head 50 | rename source_label as \"Source\" host as \"Host\" evidence as \"Event\""
      }
    }
  },
  "visualizations": {
    "viz_header": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "# Scenario — CPU Runaway\n\n| Property | Value |\n|----------|-------|\n| **demo_id** | `cpu_runaway` |\n| **Category** | Operations |\n| **Duration** | Days 11–12 (~32 hours) |\n| **Severity** | High |\n| **Target** | SQL-PROD-01 (10.10.20.30, Boston) |\n| **Root Cause** | SQL backup job hits locked table, infinite retry loop |\n| **Outcome** | DBA kills job & restarts SQL service at Day 12 10:30 |\n\n**Scenario Summary:** SQL backup job starts at Day 11 02:00 and hits a locked table, entering an infinite retry loop. CPU climbs from 40% through 65% (warning), 78% (escalating), 88% (high), to 100% saturation by Day 12 08:00. Database connections fail, web errors cascade. DBA manually kills the stuck process and restarts SQL service at 10:30, CPU returns to normal by 18:00.",
        "fontColor": "#C3CBD4"
      }
    },
    "viz_kpi_total_events": {
      "type": "splunk.singlevalue",
      "title": "Scenario Events",
      "dataSources": {
        "primary": "ds_total_events"
      },
      "options": {
        "majorValue": "> sparklineValues | lastPoint()",
        "trendValue": "> sparklineValues | delta(-2)",
        "sparklineValues": "> primary | seriesByName('count')",
        "sparklineDisplay": "below",
        "trendDisplay": "percent",
        "majorColor": "#FF677B",
        "trendColor": "> trendValue | rangeValue(trendColorConfig)",
        "backgroundColor": "transparent",
        "showSparklineAreaGraph": true,
        "sparklineStrokeColor": "#FF677B"
      },
      "context": {
        "trendColorConfig": [
          { "value": "#DC4E41", "to": 0 },
          { "value": "#53A051", "from": 0 }
        ]
      }
    },
    "viz_kpi_sourcetypes": {
      "type": "splunk.singlevalue",
      "title": "Affected Sources",
      "dataSources": {
        "primary": "ds_affected_sourcetypes"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "#7B56DB",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      }
    },
    "viz_kpi_hosts": {
      "type": "splunk.singlevalue",
      "title": "Affected Hosts",
      "dataSources": {
        "primary": "ds_affected_hosts"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "#009CEB",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      }
    },
    "viz_kpi_peak_cpu": {
      "type": "splunk.singlevalue",
      "title": "Peak CPU %",
      "dataSources": {
        "primary": "ds_peak_cpu"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "> majorValue | rangeValue(cpuColorConfig)",
        "unit": "%",
        "unitPosition": "after",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      },
      "context": {
        "cpuColorConfig": [
          { "value": "#53A051", "to": 70 },
          { "value": "#F8BE34", "from": 70, "to": 90 },
          { "value": "#DC4E41", "from": 90 }
        ]
      }
    },
    "viz_cpu_timeline": {
      "type": "splunk.line",
      "title": "CPU Usage (% Processor Time) — SQL-PROD-01",
      "dataSources": {
        "primary": "ds_cpu_timeline"
      },
      "options": {
        "legendDisplay": "off",
        "nullValueDisplay": "connect",
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "% CPU",
        "yAxisTitleVisibility": "show",
        "seriesColors": ["#FF677B"]
      },
      "showProgressBar": true
    },
    "viz_memory_timeline": {
      "type": "splunk.line",
      "title": "Available Memory (MBytes) — SQL-PROD-01",
      "dataSources": {
        "primary": "ds_memory_timeline"
      },
      "options": {
        "legendDisplay": "off",
        "nullValueDisplay": "connect",
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "MBytes Free",
        "yAxisTitleVisibility": "show",
        "yAxisAbbreviation": "auto",
        "seriesColors": ["#7B56DB"]
      },
      "showProgressBar": true
    },
    "viz_cross_source": {
      "type": "splunk.area",
      "title": "Cross-Source Correlation Timeline",
      "dataSources": {
        "primary": "ds_cross_source"
      },
      "options": {
        "stackMode": "stacked",
        "legendDisplay": "right",
        "nullValueDisplay": "zero",
        "areaOpacity": 0.7,
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "Events / hour",
        "yAxisTitleVisibility": "show",
        "yAxisAbbreviation": "auto",
        "seriesColors": ["#FF677B", "#DC4E41", "#00D2FF", "#53A051"]
      },
      "showProgressBar": true,
      "showLastUpdated": true
    },
    "viz_events_donut": {
      "type": "splunk.pie",
      "title": "Events by Source",
      "dataSources": {
        "primary": "ds_events_by_source"
      },
      "options": {
        "labelDisplay": "valuesAndPercentage",
        "showDonutHole": true,
        "seriesColors": ["#FF677B", "#DC4E41", "#00D2FF", "#53A051"]
      }
    },
    "viz_sql_events": {
      "type": "splunk.table",
      "title": "SQL Server Events (WinEventLog)",
      "dataSources": {
        "primary": "ds_sql_events"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true
    },
    "viz_http_errors": {
      "type": "splunk.line",
      "title": "HTTP Error Rate (%)",
      "dataSources": {
        "primary": "ds_http_errors"
      },
      "options": {
        "legendDisplay": "off",
        "nullValueDisplay": "zero",
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "Error Rate %",
        "yAxisTitleVisibility": "show",
        "seriesColors": ["#DC4E41"]
      },
      "showProgressBar": true
    },
    "viz_evidence_header": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "### Key Evidence",
        "fontColor": "#C3CBD4"
      }
    },
    "viz_key_evidence": {
      "type": "splunk.table",
      "title": "Evidence Timeline (Most Recent)",
      "dataSources": {
        "primary": "ds_key_evidence"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true,
      "showLastUpdated": true
    }
  },
  "inputs": {
    "input_global_trp": {
      "type": "input.timerange",
      "title": "Time Range",
      "options": {
        "token": "global_time",
        "defaultValue": "1767225600,1769904000"
      }
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "earliest": "$global_time.earliest$",
            "latest": "$global_time.latest$"
          }
        }
      }
    }
  },
  "layout": {
    "type": "grid",
    "globalInputs": ["input_global_trp"],
    "structure": [
      {
        "item": "viz_header",
        "type": "block",
        "position": { "x": 0, "y": 0, "w": 1200, "h": 250 }
      },
      {
        "item": "viz_kpi_total_events",
        "type": "block",
        "position": { "x": 0, "y": 250, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_sourcetypes",
        "type": "block",
        "position": { "x": 300, "y": 250, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_hosts",
        "type": "block",
        "position": { "x": 600, "y": 250, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_peak_cpu",
        "type": "block",
        "position": { "x": 900, "y": 250, "w": 300, "h": 120 }
      },
      {
        "item": "viz_cpu_timeline",
        "type": "block",
        "position": { "x": 0, "y": 370, "w": 600, "h": 300 }
      },
      {
        "item": "viz_memory_timeline",
        "type": "block",
        "position": { "x": 600, "y": 370, "w": 600, "h": 300 }
      },
      {
        "item": "viz_cross_source",
        "type": "block",
        "position": { "x": 0, "y": 670, "w": 750, "h": 350 }
      },
      {
        "item": "viz_events_donut",
        "type": "block",
        "position": { "x": 750, "y": 670, "w": 450, "h": 350 }
      },
      {
        "item": "viz_sql_events",
        "type": "block",
        "position": { "x": 0, "y": 1020, "w": 600, "h": 300 }
      },
      {
        "item": "viz_http_errors",
        "type": "block",
        "position": { "x": 600, "y": 1020, "w": 600, "h": 300 }
      },
      {
        "item": "viz_evidence_header",
        "type": "block",
        "position": { "x": 0, "y": 1320, "w": 1200, "h": 50 }
      },
      {
        "item": "viz_key_evidence",
        "type": "block",
        "position": { "x": 0, "y": 1370, "w": 1200, "h": 400 }
      }
    ]
  }
}
  ]]></definition>
</dashboard>
