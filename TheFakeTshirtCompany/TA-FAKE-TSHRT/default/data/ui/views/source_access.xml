<dashboard version="1.1" theme="dark">
  <label>Apache Access</label>
  <description>Apache web server access logs in combined format</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #2d1f1f 100%); border-radius: 8px; border-left: 4px solid #dc4e41;">
          <h2 style="color: #dc4e41; margin-top: 0;">Apache Access Logs</h2>
          <p style="color: #ccc; font-size: 1.1em;">Web server access logs showing HTTP requests, response codes, and user agents from WEB-01 and WEB-02.</p>
          <div style="display: flex; gap: 30px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Sourcetype:</span> <code style="color: #5CC05C;">FAKE:access_combined</code>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Format:</span> <strong style="color: #fff;">Combined Log Format</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Servers:</span> <strong style="color: #fff;">WEB-01, WEB-02</strong>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Requests Over Time</title>
      <chart>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:access_combined" by _time span=1h</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"count": 0xdc4e41}</option>
      </chart>
    </panel>
    <panel>
      <title>Response Codes</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined"
| eval status_group=case(status>=200 AND status<300, "2xx Success", status>=300 AND status<400, "3xx Redirect", status>=400 AND status<500, "4xx Client Error", status>=500, "5xx Server Error", true(), "Other")
| stats count by status_group</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Total Requests</title>
      <single>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:access_combined"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Unique Clients</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined" | stats dc(clientip)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0x5CC05C"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Error Responses (4xx/5xx)</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined" status>=400 | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xf8be34","0xf8be34"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Server Errors (5xx)</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined" status>=500 | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Key Fields</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Field</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Description</th>
            </tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">clientip</td><td style="padding: 8px; border: 1px solid #444;">Client IP address</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">method</td><td style="padding: 8px; border: 1px solid #444;">GET, POST, etc.</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">uri_path</td><td style="padding: 8px; border: 1px solid #444;">Request path</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">status</td><td style="padding: 8px; border: 1px solid #444;">HTTP status code</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">bytes</td><td style="padding: 8px; border: 1px solid #444;">Response size</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">referer</td><td style="padding: 8px; border: 1px solid #444;">Referring URL</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">useragent</td><td style="padding: 8px; border: 1px solid #444;">Browser/client info</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">demo_id</td><td style="padding: 8px; border: 1px solid #444;">Scenario identifier</td></tr>
          </table>
        </div>
      </html>
    </panel>
    <panel>
      <title>Scenario Events</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <h4 style="color: #f8be34; margin-top: 0;">CPU Runaway</h4>
          <p style="color: #ccc;">502/503 errors during SQL-PROD-01 CPU saturation</p>

          <h4 style="color: #dc4e41; margin-top: 15px;">Certificate Expiry</h4>
          <p style="color: #ccc;">502/503 errors during SSL outage (Day 12, 00:00-07:00)</p>

          <h4 style="color: #5CC05C; margin-top: 15px;">Normal Traffic</h4>
          <p style="color: #ccc;">E-commerce activity: /products/, /cart/, /checkout/</p>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Top URIs</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined"
| stats count by uri_path
| sort - count
| head 15</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Top Status Codes</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined"
| stats count by status
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Top Client IPs</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined"
| stats count by clientip
| sort - count
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Use Cases</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #5CC05C; margin-top: 0;">Common SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">Error Rate Over Time</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:access_combined"
| eval error=if(status>=400, 1, 0)
| timechart span=1h sum(error) AS errors, count AS total
| eval error_rate=round(errors/total*100,2)</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Server Errors (5xx)</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:access_combined" status>=500
| stats count by status, uri_path
| sort - count</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Slow Requests (by bytes)</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:access_combined" bytes>100000
| stats count, avg(bytes) AS avg_bytes by uri_path
| sort - avg_bytes</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Product Page Views</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:access_combined" uri_path="/products/*"
| rex field=uri_path "/products/(?&lt;product&gt;[^/]+)"
| stats count by product | sort - count</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Sample Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:access_combined"
| table _time, clientip, method, uri_path, status, bytes, demo_id
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
