<dashboard version="2" theme="dark">
  <label>Scenario - Data Exfiltration</label>
  <description>APT-style data exfiltration — 14-day attack spanning reconnaissance, initial access, lateral movement, persistence, and exfiltration</description>
  <definition><![CDATA[
{
  "title": "Scenario - Data Exfiltration",
  "description": "APT-style data exfiltration — 14-day attack spanning reconnaissance, initial access, lateral movement, persistence, and exfiltration",
  "dataSources": {
    "ds_total_events": {
      "type": "ds.search",
      "name": "Total Exfil Scenario Events Over Time",
      "options": {
        "query": "| tstats count where index=fake_tshrt IDX_demo_id=exfil by _time span=1h"
      }
    },
    "ds_affected_sourcetypes": {
      "type": "ds.search",
      "name": "Affected Sourcetype Count",
      "options": {
        "query": "| tstats dc(sourcetype) as count where index=fake_tshrt IDX_demo_id=exfil"
      }
    },
    "ds_affected_hosts": {
      "type": "ds.search",
      "name": "Affected Host Count",
      "options": {
        "query": "| tstats dc(host) as count where index=fake_tshrt IDX_demo_id=exfil"
      }
    },
    "ds_affected_users": {
      "type": "ds.search",
      "name": "Affected User Count",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil user=* | stats dc(user) as count"
      }
    },
    "ds_phase_timeline": {
      "type": "ds.search",
      "name": "Events by Attack Phase Over Time",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil | eval phase=case(_time < 1767484800, \"1 - Recon\", _time < 1767571200, \"2 - Initial Access\", _time < 1767830400, \"3 - Lateral Movement\", _time < 1768089600, \"4 - Persistence\", 1=1, \"5 - Exfiltration\") | timechart span=4h count by phase"
      }
    },
    "ds_cross_source": {
      "type": "ds.search",
      "name": "Events by Sourcetype Over Time",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil | eval source_label=case(match(sourcetype,\"cisco:asa\"), \"ASA Firewall\", match(sourcetype,\"azure:aad\"), \"Entra ID\", match(sourcetype,\"aws:cloudtrail\"), \"AWS CloudTrail\", match(sourcetype,\"google:gcp\"), \"GCP Audit\", match(sourcetype,\"o365:reporting\"), \"Exchange\", match(sourcetype,\"o365:management\"), \"M365 Audit\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"Perfmon\"), \"Perfmon\", match(sourcetype,\"servicenow\"), \"ServiceNow\", match(sourcetype,\"Sysmon\"), \"Sysmon\", match(sourcetype,\"mssql\"), \"MSSQL\", 1=1, \"Other\") | timechart span=4h count by source_label"
      }
    },
    "ds_events_by_source": {
      "type": "ds.search",
      "name": "Events by Source Type",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil | eval source_label=case(match(sourcetype,\"cisco:asa\"), \"ASA Firewall\", match(sourcetype,\"azure:aad\"), \"Entra ID\", match(sourcetype,\"aws:cloudtrail\"), \"AWS CloudTrail\", match(sourcetype,\"google:gcp\"), \"GCP Audit\", match(sourcetype,\"o365:reporting\"), \"Exchange\", match(sourcetype,\"o365:management\"), \"M365 Audit\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"Perfmon\"), \"Perfmon\", match(sourcetype,\"servicenow\"), \"ServiceNow\", match(sourcetype,\"Sysmon\"), \"Sysmon\", match(sourcetype,\"mssql\"), \"MSSQL\", 1=1, \"Other\") | stats count by source_label | sort -count"
      }
    },
    "ds_threat_actor_activity": {
      "type": "ds.search",
      "name": "Threat Actor Activity (185.220.101.42)",
      "options": {
        "query": "index=fake_tshrt sourcetype=\"FAKE:cisco:asa\" src=185.220.101.42 demo_id=exfil | timechart span=4h count by action"
      }
    },
    "ds_compromised_users": {
      "type": "ds.search",
      "name": "Compromised User Activity",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil (user=\"*jessica.brown*\" OR user=\"*alex.miller*\" OR user=\"jessica.brown\" OR user=\"alex.miller\") | eval source_label=case(match(sourcetype,\"cisco:asa\"), \"ASA\", match(sourcetype,\"azure:aad\"), \"Entra ID\", match(sourcetype,\"aws\"), \"AWS\", match(sourcetype,\"gcp\"), \"GCP\", match(sourcetype,\"o365:reporting\"), \"Exchange\", match(sourcetype,\"o365:management\"), \"M365\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", 1=1, sourcetype) | stats count earliest(_time) as first_seen latest(_time) as last_seen by user source_label | eval first_seen=strftime(first_seen, \"%Y-%m-%d %H:%M\"), last_seen=strftime(last_seen, \"%Y-%m-%d %H:%M\") | sort user -count | rename user as \"User\" source_label as \"Source\" first_seen as \"First Seen\" last_seen as \"Last Seen\""
      }
    },
    "ds_lateral_movement": {
      "type": "ds.search",
      "name": "Lateral Movement (Cross-Site Traffic)",
      "options": {
        "query": "index=fake_tshrt sourcetype=\"FAKE:cisco:asa\" demo_id=exfil (src=\"10.20.30.*\" dest=\"10.10.*\") OR (src=\"10.10.30.*\" dest=\"10.20.*\") | stats count by src dest | sort -count | head 20 | rename src as \"Source\" dest as \"Destination\""
      }
    },
    "ds_cloud_access": {
      "type": "ds.search",
      "name": "Cloud Data Access Events",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil (sourcetype=\"FAKE:aws:cloudtrail\" OR sourcetype=\"FAKE:google:gcp:*\") | eval event=coalesce(eventName, methodName, \"unknown\") | eval principal=coalesce(userIdentity.userName, principalEmail, user, \"unknown\") | stats count by event principal sourcetype | sort -count | head 20 | rename event as \"Event\" principal as \"Principal\" sourcetype as \"Source\""
      }
    },
    "ds_key_evidence": {
      "type": "ds.search",
      "name": "Key Evidence Timeline",
      "options": {
        "query": "index=fake_tshrt demo_id=exfil | eval evidence=coalesce(eventName, action, Operation, EventCode, short_description, methodName, \"event\") | eval actor=coalesce(user, userIdentity.userName, principalEmail, src, \"unknown\") | eval phase=case(_time < 1767484800, \"Recon\", _time < 1767571200, \"Initial Access\", _time < 1767830400, \"Lateral Movement\", _time < 1768089600, \"Persistence\", 1=1, \"Exfiltration\") | eval source_label=case(match(sourcetype,\"cisco:asa\"), \"ASA\", match(sourcetype,\"azure:aad\"), \"Entra ID\", match(sourcetype,\"aws\"), \"AWS\", match(sourcetype,\"gcp\"), \"GCP\", match(sourcetype,\"o365:reporting\"), \"Exchange\", match(sourcetype,\"o365:management\"), \"M365\", match(sourcetype,\"WinEventLog\"), \"WinEventLog\", match(sourcetype,\"Perfmon\"), \"Perfmon\", 1=1, sourcetype) | table _time phase source_label actor evidence | sort -_time | head 50 | rename phase as \"Phase\" source_label as \"Source\" actor as \"Actor\" evidence as \"Event\""
      }
    }
  },
  "visualizations": {
    "viz_header": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "# Scenario — Data Exfiltration (APT)\n\n| Property | Value |\n|----------|-------|\n| **demo_id** | `exfil` |\n| **Category** | Security |\n| **Duration** | Days 1–14 (full dataset) |\n| **Severity** | Critical |\n| **Attacker IP** | 185.220.101.42 (Frankfurt, DE) |\n| **Initial Compromise** | Jessica Brown (IT Admin, Atlanta) |\n| **Primary Target** | Alex Miller (Sr. Financial Analyst, Boston) |\n\n**Attack Summary:** External threat actor conducts 14-day APT campaign. Begins with port scanning and phishing (Days 1-3), compromises Atlanta IT admin via credential harvesting (Day 4), moves laterally from Atlanta to Boston (Days 5-7), creates backdoor cloud accounts and escalates privileges (Days 8-10), then exfiltrates sensitive financial data via AWS S3 and GCP Storage during nighttime hours (Days 11-14).",
        "fontColor": "#C3CBD4"
      }
    },
    "viz_kpi_total_events": {
      "type": "splunk.singlevalue",
      "title": "Scenario Events",
      "dataSources": {
        "primary": "ds_total_events"
      },
      "options": {
        "majorValue": "> sparklineValues | lastPoint()",
        "trendValue": "> sparklineValues | delta(-2)",
        "sparklineValues": "> primary | seriesByName('count')",
        "sparklineDisplay": "below",
        "trendDisplay": "percent",
        "majorColor": "#DC4E41",
        "trendColor": "> trendValue | rangeValue(trendColorConfig)",
        "backgroundColor": "transparent",
        "showSparklineAreaGraph": true,
        "sparklineStrokeColor": "#DC4E41"
      },
      "context": {
        "trendColorConfig": [
          { "value": "#DC4E41", "to": 0 },
          { "value": "#53A051", "from": 0 }
        ]
      }
    },
    "viz_kpi_sourcetypes": {
      "type": "splunk.singlevalue",
      "title": "Affected Sources",
      "dataSources": {
        "primary": "ds_affected_sourcetypes"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "#7B56DB",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      }
    },
    "viz_kpi_hosts": {
      "type": "splunk.singlevalue",
      "title": "Affected Hosts",
      "dataSources": {
        "primary": "ds_affected_hosts"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "#009CEB",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      }
    },
    "viz_kpi_users": {
      "type": "splunk.singlevalue",
      "title": "Affected Users",
      "dataSources": {
        "primary": "ds_affected_users"
      },
      "options": {
        "majorValue": "> primary | seriesByName('count') | lastPoint()",
        "majorColor": "#F8BE34",
        "backgroundColor": "transparent",
        "sparklineDisplay": "off"
      }
    },
    "viz_phase_header": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "### Attack Phases\n\n| Phase | Days | Activity |\n|-------|------|----------|\n| **1 — Reconnaissance** | 1-3 | Port scanning, phishing email sent |\n| **2 — Initial Access** | 4 | Jessica Brown clicks phishing link, credentials harvested |\n| **3 — Lateral Movement** | 5-7 | Cross-site probing ATL→BOS, SMB/RDP attempts |\n| **4 — Persistence** | 8-10 | Backdoor AWS/GCP accounts, privilege escalation |\n| **5 — Exfiltration** | 11-14 | Nighttime data theft via cloud storage |",
        "fontColor": "#C3CBD4"
      }
    },
    "viz_phase_timeline": {
      "type": "splunk.area",
      "title": "Events by Attack Phase",
      "dataSources": {
        "primary": "ds_phase_timeline"
      },
      "options": {
        "stackMode": "stacked",
        "legendDisplay": "right",
        "nullValueDisplay": "zero",
        "areaOpacity": 0.7,
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "Events / 4h",
        "yAxisTitleVisibility": "show",
        "yAxisAbbreviation": "auto",
        "seriesColors": ["#F8BE34", "#F1813F", "#FF677B", "#7B56DB", "#DC4E41"]
      },
      "showProgressBar": true,
      "showLastUpdated": true
    },
    "viz_cross_source": {
      "type": "splunk.area",
      "title": "Cross-Source Correlation Timeline",
      "dataSources": {
        "primary": "ds_cross_source"
      },
      "options": {
        "stackMode": "stacked",
        "legendDisplay": "right",
        "nullValueDisplay": "zero",
        "areaOpacity": 0.7,
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "Events / 4h",
        "yAxisTitleVisibility": "show",
        "yAxisAbbreviation": "auto",
        "seriesColors": ["#DC4E41", "#00D2FF", "#7B56DB", "#53A051", "#F8BE34", "#009CEB", "#F1813F", "#00CDAF", "#FF677B", "#AE8CFF"]
      },
      "showProgressBar": true,
      "showLastUpdated": true
    },
    "viz_events_donut": {
      "type": "splunk.pie",
      "title": "Events by Source",
      "dataSources": {
        "primary": "ds_events_by_source"
      },
      "options": {
        "labelDisplay": "valuesAndPercentage",
        "showDonutHole": true,
        "seriesColors": ["#DC4E41", "#00D2FF", "#7B56DB", "#53A051", "#F8BE34", "#009CEB", "#F1813F", "#00CDAF", "#FF677B", "#AE8CFF"]
      }
    },
    "viz_threat_actor": {
      "type": "splunk.line",
      "title": "Threat Actor Activity (185.220.101.42)",
      "dataSources": {
        "primary": "ds_threat_actor_activity"
      },
      "options": {
        "legendDisplay": "bottom",
        "nullValueDisplay": "zero",
        "backgroundColor": "transparent",
        "xAxisTitleVisibility": "hide",
        "yAxisTitleText": "Events",
        "yAxisTitleVisibility": "show",
        "seriesColors": ["#DC4E41", "#53A051", "#F8BE34"]
      },
      "showProgressBar": true
    },
    "viz_compromised_users": {
      "type": "splunk.table",
      "title": "Compromised User Activity",
      "dataSources": {
        "primary": "ds_compromised_users"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true
    },
    "viz_lateral_movement": {
      "type": "splunk.table",
      "title": "Lateral Movement (Cross-Site Traffic)",
      "dataSources": {
        "primary": "ds_lateral_movement"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true
    },
    "viz_cloud_access": {
      "type": "splunk.table",
      "title": "Cloud Data Access",
      "dataSources": {
        "primary": "ds_cloud_access"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true
    },
    "viz_evidence_header": {
      "type": "splunk.markdown",
      "options": {
        "markdown": "### Key Evidence",
        "fontColor": "#C3CBD4"
      }
    },
    "viz_key_evidence": {
      "type": "splunk.table",
      "title": "Evidence Timeline (Most Recent)",
      "dataSources": {
        "primary": "ds_key_evidence"
      },
      "options": {
        "count": 20,
        "showRowNumbers": false
      },
      "showProgressBar": true,
      "showLastUpdated": true
    }
  },
  "inputs": {
    "input_global_trp": {
      "type": "input.timerange",
      "title": "Time Range",
      "options": {
        "token": "global_time",
        "defaultValue": "1767225600,1769904000"
      }
    }
  },
  "defaults": {
    "dataSources": {
      "ds.search": {
        "options": {
          "queryParameters": {
            "earliest": "$global_time.earliest$",
            "latest": "$global_time.latest$"
          }
        }
      }
    }
  },
  "layout": {
    "type": "grid",
    "globalInputs": ["input_global_trp"],
    "structure": [
      {
        "item": "viz_header",
        "type": "block",
        "position": { "x": 0, "y": 0, "w": 1200, "h": 280 }
      },
      {
        "item": "viz_kpi_total_events",
        "type": "block",
        "position": { "x": 0, "y": 280, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_sourcetypes",
        "type": "block",
        "position": { "x": 300, "y": 280, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_hosts",
        "type": "block",
        "position": { "x": 600, "y": 280, "w": 300, "h": 120 }
      },
      {
        "item": "viz_kpi_users",
        "type": "block",
        "position": { "x": 900, "y": 280, "w": 300, "h": 120 }
      },
      {
        "item": "viz_phase_header",
        "type": "block",
        "position": { "x": 0, "y": 400, "w": 1200, "h": 180 }
      },
      {
        "item": "viz_phase_timeline",
        "type": "block",
        "position": { "x": 0, "y": 580, "w": 1200, "h": 350 }
      },
      {
        "item": "viz_cross_source",
        "type": "block",
        "position": { "x": 0, "y": 930, "w": 750, "h": 350 }
      },
      {
        "item": "viz_events_donut",
        "type": "block",
        "position": { "x": 750, "y": 930, "w": 450, "h": 350 }
      },
      {
        "item": "viz_threat_actor",
        "type": "block",
        "position": { "x": 0, "y": 1280, "w": 600, "h": 300 }
      },
      {
        "item": "viz_compromised_users",
        "type": "block",
        "position": { "x": 600, "y": 1280, "w": 600, "h": 300 }
      },
      {
        "item": "viz_lateral_movement",
        "type": "block",
        "position": { "x": 0, "y": 1580, "w": 600, "h": 300 }
      },
      {
        "item": "viz_cloud_access",
        "type": "block",
        "position": { "x": 600, "y": 1580, "w": 600, "h": 300 }
      },
      {
        "item": "viz_evidence_header",
        "type": "block",
        "position": { "x": 0, "y": 1880, "w": 1200, "h": 50 }
      },
      {
        "item": "viz_key_evidence",
        "type": "block",
        "position": { "x": 0, "y": 1930, "w": 1200, "h": 400 }
      }
    ]
  }
}
  ]]></definition>
</dashboard>
