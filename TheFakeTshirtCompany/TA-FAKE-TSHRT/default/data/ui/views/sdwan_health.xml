<dashboard version="1.1" theme="dark">
  <label>SD-WAN &amp; Network Health</label>
  <description>Monitor multi-site SD-WAN performance, VPN tunnels, and failover events</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #1f2d2d 100%); border-radius: 8px; border-left: 4px solid #0877a6;">
          <h2 style="color: #0877a6; margin-top: 0;">SD-WAN &amp; Network Health</h2>
          <p style="color: #ccc; font-size: 1.1em;">Monitor MX appliance health across Boston (HA pair), Atlanta, and Austin. Track WAN latency, VPN tunnels, and failover events.</p>
          <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #00bceb;">Boston:</span> <strong style="color: #5CC05C;">MX-BOS-01/02 (HA)</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #f8be34;">Atlanta:</span> <strong style="color: #5CC05C;">MX-ATL-01</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #dc4e41;">Austin:</span> <strong style="color: #5CC05C;">MX-AUS-01</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Sourcetype:</span> <code style="color: #5CC05C;">FAKE:meraki:securityappliances</code>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Avg Latency (ms)</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| stats avg(eventData.latency_ms) AS avg_latency
| eval avg_latency=round(avg_latency, 1)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[50,100]</option>
        <option name="useColors">1</option>
        <option name="unit">ms</option>
      </single>
    </panel>
    <panel>
      <title>Avg Packet Loss</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| stats avg(eventData.loss_pct) AS avg_loss
| eval avg_loss=round(avg_loss, 2)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[1,3]</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
      </single>
    </panel>
    <panel>
      <title>Failover Events</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_failover
| stats count AS failovers</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[3,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>VPN Tunnels</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=vpn_tunnel_status eventData.status=up
| stats dc(eventData.peer) AS tunnels_up</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xf8be34","0x5CC05C"]</option>
        <option name="rangeValues">[2,4]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>WAN Latency by Site</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    true(), "Other"
)
| timechart span=2h avg(eventData.latency_ms) by site</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="height">300</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.fieldColors">{"Boston": 0x00bceb, "Atlanta": 0x5CC05C, "Austin": 0xf8be34}</option>
        <option name="charting.axisTitleY.text">Latency (ms)</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Jitter by Site</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    true(), "Other"
)
| stats avg(eventData.jitter_ms) AS avg_jitter by site
| eval avg_jitter=round(avg_jitter, 1)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"avg_jitter": 0x0877a6}</option>
        <option name="charting.axisTitleY.text">Jitter (ms)</option>
      </chart>
    </panel>
    <panel>
      <title>Packet Loss Trend</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| timechart span=4h avg(eventData.loss_pct) AS "Packet Loss %"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"Packet Loss %": 0xdc4e41}</option>
        <option name="charting.axisTitleY.text">Loss %</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>SD-WAN Health Status by Device</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| stats latest(eventData.latency_ms) AS latency, latest(eventData.jitter_ms) AS jitter, latest(eventData.loss_pct) AS loss, latest(eventData.status) AS status, latest(_time) AS last_seen by deviceName, eventData.wan_link
| eval latency=round(latency, 1), jitter=round(jitter, 1), loss=round(loss, 2)
| eval last_seen=strftime(last_seen, "%Y-%m-%d %H:%M")
| sort deviceName, eventData.wan_link
| rename deviceName AS "Device", eventData.wan_link AS "WAN Link", latency AS "Latency (ms)", jitter AS "Jitter (ms)", loss AS "Loss %", status AS "Status", last_seen AS "Last Seen"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">12</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>VPN Tunnel Status</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=vpn_tunnel_status
| stats latest(eventData.status) AS status, latest(_time) AS last_seen, count AS events by deviceName, eventData.peer
| eval last_seen=strftime(last_seen, "%Y-%m-%d %H:%M")
| sort deviceName, eventData.peer
| rename deviceName AS "Local Device", eventData.peer AS "Peer", status AS "Status", last_seen AS "Last Update", events AS "Events"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <title>Network Topology</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <h4 style="color: #0877a6; margin-top: 0;">AutoVPN Mesh Topology</h4>
          <pre style="background: #0d0d0d; padding: 15px; border-radius: 3px; color: #5CC05C; font-family: monospace; font-size: 12px;">
              INTERNET
                  |
          [FW-EDGE-01]  (ASA 5525-X - Perimeter)
                  |
          +-------+-------+
          |               |
    [MX-BOS-01/02]   [SD-WAN Transit]
     (HA Pair)            |
          |         +-----+-----+
          |         |           |
          |    [MX-ATL-01] [MX-AUS-01]
          |     Atlanta     Austin
          |
     Boston HQ
          </pre>
          <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 6px; border: 1px solid #444;">Site</th>
              <th style="padding: 6px; border: 1px solid #444;">Device</th>
              <th style="padding: 6px; border: 1px solid #444;">Model</th>
              <th style="padding: 6px; border: 1px solid #444;">WAN Links</th>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #00bceb;">Boston</td>
              <td style="padding: 6px; border: 1px solid #444;">MX-BOS-01/02</td>
              <td style="padding: 6px; border: 1px solid #444;">MX450</td>
              <td style="padding: 6px; border: 1px solid #444;">Comcast, AT&amp;T</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #5CC05C;">Atlanta</td>
              <td style="padding: 6px; border: 1px solid #444;">MX-ATL-01</td>
              <td style="padding: 6px; border: 1px solid #444;">MX250</td>
              <td style="padding: 6px; border: 1px solid #444;">AT&amp;T, Spectrum</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #f8be34;">Austin</td>
              <td style="padding: 6px; border: 1px solid #444;">MX-AUS-01</td>
              <td style="padding: 6px; border: 1px solid #444;">MX85</td>
              <td style="padding: 6px; border: 1px solid #444;">Verizon</td>
            </tr>
          </table>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Failover Events Timeline</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_failover
| table _time, deviceName, eventData.from_wan, eventData.to_wan, eventData.reason
| sort - _time
| rename deviceName AS "Device", eventData.from_wan AS "From WAN", eventData.to_wan AS "To WAN", eventData.reason AS "Reason"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Investigation Queries</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #0877a6; margin-top: 0;">Useful SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">High Latency Events</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health eventData.latency_ms&gt;100
| table _time, deviceName, eventData.wan_link, eventData.latency_ms, eventData.jitter_ms</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Failover Analysis</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_failover
| stats count by deviceName, eventData.reason
| sort - count</pre>

          <h4 style="color: #ccc; margin-top: 20px;">VPN Tunnel Flapping</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=vpn_tunnel_status
| stats count by deviceName, eventData.peer, eventData.status
| where count&gt;5</pre>

          <h4 style="color: #ccc; margin-top: 20px;">WAN Link Comparison</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| stats avg(eventData.latency_ms) AS avg_latency, avg(eventData.loss_pct) AS avg_loss by deviceName, eventData.wan_link
| sort deviceName, avg_latency</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Recent SD-WAN Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" (type=sd_wan_health OR type=sd_wan_failover OR type=vpn_tunnel_status)
| table _time, deviceName, type, eventData.wan_link, eventData.latency_ms, eventData.status, eventData.peer
| sort - _time
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
