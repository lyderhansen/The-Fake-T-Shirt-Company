<dashboard version="1.1" theme="dark">
  <label>Network Operations Discovery</label>
  <description>NOC-focused overview of WAN health, wireless, switching, and perimeter</description>

  <fieldset submitButton="false">
    <input type="time" token="time">
      <label>Time Range</label>
      <default>
        <earliest>1736726400</earliest>
        <latest>1736899199</latest>
      </default>
    </input>
    <input type="dropdown" token="location">
      <label>Location</label>
      <choice value="*">All Locations</choice>
      <choice value="BOS">Boston</choice>
      <choice value="ATL">Atlanta</choice>
      <choice value="AUS">Austin</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- Row 1: Header -->
  <row>
    <panel>
      <html>
        <style>
          .network-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-left: 4px solid #0877a6;
            padding: 20px 25px;
            border-radius: 8px;
            margin: -10px;
          }
          .network-header h1 {
            color: #00bceb;
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
          }
          .network-header p {
            color: #a0a0a0;
            margin: 5px 0;
            font-size: 13px;
          }
          .topology-box {
            display: flex;
            gap: 20px;
            margin-top: 15px;
          }
          .topology-item {
            background: rgba(8, 119, 166, 0.2);
            border: 1px solid #0877a6;
            padding: 8px 15px;
            border-radius: 4px;
          }
          .topology-item span {
            color: #00bceb;
            font-weight: 600;
          }
        </style>
        <div class="network-header">
          <h1>Network Operations Discovery</h1>
          <p><strong>Data Sources:</strong> Cisco ASA | Meraki MX (SD-WAN) | Meraki MR (Wireless) | Meraki MS (Switching)</p>
          <p><strong>Topology:</strong> 3 Sites (Boston/Atlanta/Austin) | AutoVPN Mesh | Dual WAN per site</p>
          <div class="topology-box">
            <div class="topology-item"><span>4x MX</span> Security Appliances</div>
            <div class="topology-item"><span>36x MR</span> Access Points</div>
            <div class="topology-item"><span>11x MS</span> Switches</div>
            <div class="topology-item"><span>3 Sites</span> SD-WAN Mesh</div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 2: Network KPIs -->
  <row>
    <panel>
      <title>Network Health Score</title>
      <single>
        <search>
          <query>index=fake_tshrt (sourcetype="FAKE:meraki:securityappliances" OR sourcetype="FAKE:meraki:accesspoints:health") (type=sd_wan_health OR type=ap_health_score)
| eval health=coalesce('eventData.performance.latest', 100-('eventData.loss_pct'*10))
| stats avg(health) AS avg_health
| eval score=round(avg_health, 0)
| table score</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["#dc4e41","#f8be34","#5CC05C"]</option>
        <option name="rangeValues">[60,85]</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Avg WAN Latency</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| spath path=eventData.latency_ms output=latency
| stats avg(latency) AS avg_latency
| eval avg_latency=round(avg_latency, 1)
| table avg_latency</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.1</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[30,50]</option>
        <option name="unit"> ms</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Packet Loss %</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| spath path=eventData.loss_pct output=loss
| stats avg(loss) AS avg_loss
| eval avg_loss=round(avg_loss, 2)
| table avg_loss</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0.00</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[0.5,2]</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>APs Online</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints:health" type=ap_health_score
| spath path=eventData.status output=status
| stats count(eval(status="online" OR status="healthy")) AS online, count AS total
| eval pct=round(online/total*100, 0)
| table pct</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["#dc4e41","#f8be34","#5CC05C"]</option>
        <option name="rangeValues">[90,95]</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Wireless Clients</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints" type=association
| stats dc(client_mac) AS clients</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#00bceb"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>VPN Tunnels Up</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=vpn_tunnel_status
| spath path=eventData.status output=status
| stats count(eval(status="up" OR status="active" OR status="connected")) AS up_tunnels
| table up_tunnels</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#dc4e41","#5CC05C"]</option>
        <option name="rangeValues">[3]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- Row 3: WAN Performance -->
  <row>
    <panel>
      <title>WAN Latency by Site</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| spath path=eventData.latency_ms output=latency
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    1=1, "Unknown")
| where site!="Unknown"
| timechart span=1h avg(latency) by site</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.fieldColors">{"Boston": #00bceb, "Atlanta": #5CC05C, "Austin": #f8be34}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Latency (ms)</option>
      </chart>
    </panel>
    <panel>
      <title>Jitter &amp; Packet Loss Trend</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| spath path=eventData.jitter_ms output=jitter
| spath path=eventData.loss_pct output=loss
| timechart span=1h avg(jitter) AS "Jitter (ms)", avg(loss) AS "Packet Loss %"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.fieldColors">{"Jitter (ms)": #f8be34, "Packet Loss %": #dc4e41}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
  </row>

  <!-- Row 4: Wireless Health -->
  <row>
    <panel>
      <title>AP Health Score by Location</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints:health" type=ap_health_score
| spath path=eventData.performance.latest output=health
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    1=1, "Unknown")
| where site!="Unknown"
| stats avg(health) AS health by site
| eval health=round(health, 0)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.fieldColors">{"health": #00bceb}</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleY.text">Health Score</option>
      </chart>
    </panel>
    <panel>
      <title>Channel Utilization Trend</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints" type=channel_utilization
| spath path=eventData.utilization_pct output=utilization
| eval band=case(
    match(deviceName, "5G") OR 'eventData.band'="5GHz", "5 GHz",
    1=1, "2.4 GHz")
| timechart span=1h avg(utilization) by band</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.fieldColors">{"5 GHz": #5CC05C, "2.4 GHz": #f8be34}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Utilization %</option>
      </chart>
    </panel>
  </row>

  <!-- Row 5: Traffic Analysis -->
  <row>
    <panel>
      <title>Firewall Throughput Over Time</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" ("Built" OR "Teardown")
| rex "bytes\s+(?&lt;bytes&gt;\d+)"
| eval bytes=tonumber(bytes)
| timechart span=1h sum(bytes) AS total_bytes
| eval total_mb=round(total_bytes/1024/1024, 2)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.fieldColors">{"total_bytes": #00bceb}</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.text">Bytes</option>
      </chart>
    </panel>
    <panel>
      <title>Top Talkers (Source IPs)</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" ("Built" OR "Teardown")
| rex "for\s+\w+:(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)"
| rex "bytes\s+(?&lt;bytes&gt;\d+)"
| eval bytes=tonumber(bytes)
| stats sum(bytes) AS total_bytes by src_ip
| eval total_mb=round(total_bytes/1024/1024, 2)
| sort - total_bytes
| head 10
| table src_ip, total_mb</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.fieldColors">{"total_mb": #5CC05C}</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
      </chart>
    </panel>
  </row>

  <!-- Row 6: Device Status -->
  <row>
    <panel>
      <title>Problem APs (Low Health or High Utilization)</title>
      <table>
        <search>
          <query>index=fake_tshrt (sourcetype="FAKE:meraki:accesspoints:health" OR sourcetype="FAKE:meraki:accesspoints") (type=ap_health_score OR type=channel_utilization)
| spath path=eventData.performance.latest output=health
| spath path=eventData.utilization_pct output=utilization
| spath path=eventData.snr output=snr
| stats latest(health) AS health, latest(utilization) AS utilization, latest(snr) AS snr by deviceName
| where health &lt; 80 OR utilization &gt; 70 OR snr &lt; 25
| eval issue=case(
    health &lt; 60, "Critical Health",
    health &lt; 80, "Low Health",
    utilization &gt; 80, "High Utilization",
    utilization &gt; 70, "Moderate Utilization",
    snr &lt; 20, "Poor SNR",
    snr &lt; 25, "Low SNR",
    1=1, "Other")
| table deviceName, health, utilization, snr, issue
| sort health</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="health">
          <colorPalette type="minMidMax" maxColor="#5CC05C" midColor="#f8be34" minColor="#dc4e41"></colorPalette>
          <scale type="minMidMax" midType="number" midValue="70"></scale>
        </format>
        <format type="color" field="utilization">
          <colorPalette type="minMidMax" maxColor="#dc4e41" midColor="#f8be34" minColor="#5CC05C"></colorPalette>
          <scale type="minMidMax" midType="number" midValue="50"></scale>
        </format>
        <format type="color" field="issue">
          <colorPalette type="map">{"Critical Health":#dc4e41,"Low Health":#f8be34,"High Utilization":#dc4e41,"Moderate Utilization":#f8be34,"Poor SNR":#dc4e41,"Low SNR":#f8be34}</colorPalette>
        </format>
      </table>
    </panel>
    <panel>
      <title>Switch Port Status</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:switches" type=port_status
| spath path=eventData.status output=status
| spath path=eventData.speed output=speed
| spath path=eventData.port output=port
| stats count by deviceName, status
| xyseries deviceName status count
| fillnull value=0
| eval total=up+down+disabled
| eval up_pct=round(up/total*100, 0)
| table deviceName, up, down, disabled, up_pct
| sort - up_pct</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="up_pct">
          <colorPalette type="minMidMax" maxColor="#5CC05C" midColor="#f8be34" minColor="#dc4e41"></colorPalette>
          <scale type="minMidMax" midType="number" midValue="80"></scale>
        </format>
        <format type="color" field="down">
          <colorPalette type="minMidMax" maxColor="#dc4e41" midColor="#f8be34" minColor="#5CC05C"></colorPalette>
          <scale type="minMidMax" midType="number" midValue="5"></scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 7: VPN & Site-to-Site -->
  <row>
    <panel>
      <title>VPN Tunnel Status</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=vpn_tunnel_status
| spath path=eventData.peer output=peer
| spath path=eventData.status output=status
| spath path=eventData.uptime_seconds output=uptime
| stats latest(status) AS status, latest(uptime) AS uptime_sec by deviceName, peer
| eval uptime_hours=round(uptime_sec/3600, 1)
| eval status_icon=case(status="up" OR status="active" OR status="connected", "Up", status="down" OR status="disconnected", "Down", 1=1, status)
| table deviceName, peer, status_icon, uptime_hours
| rename deviceName AS "Device", peer AS "Peer", status_icon AS "Status", uptime_hours AS "Uptime (hrs)"
| sort Device</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <title>SD-WAN Failover Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_failover
| spath path=eventData.from_wan output=from_wan
| spath path=eventData.to_wan output=to_wan
| spath path=eventData.reason output=reason
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    1=1, deviceName)
| table _time, site, from_wan, to_wan, reason
| sort - _time
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="reason">
          <colorPalette type="map">{"packet_loss":#dc4e41,"latency":#f8be34,"manual":#00bceb,"failback":#5CC05C}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 8: Investigation Queries -->
  <row>
    <panel>
      <html>
        <style>
          .network-queries {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 20px;
          }
          .network-queries h3 {
            color: #00bceb;
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
          }
          .query-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
          }
          .query-card {
            background: #16213e;
            border-radius: 6px;
            padding: 15px;
            border-left: 3px solid #00bceb;
          }
          .query-card h4 {
            color: #e0e0e0;
            margin: 0 0 8px 0;
            font-size: 14px;
          }
          .query-card code {
            display: block;
            background: #0d1421;
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #888;
            overflow-x: auto;
            white-space: pre-wrap;
          }
        </style>
        <div class="network-queries">
          <h3>Network Investigation Queries</h3>
          <div class="query-grid">
            <div class="query-card">
              <h4>WAN Latency Spikes</h4>
              <code>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=sd_wan_health
| spath path=eventData.latency_ms output=latency
| where latency &gt; 100
| stats count, avg(latency) AS avg_latency by deviceName
| sort - avg_latency</code>
            </div>
            <div class="query-card">
              <h4>Wireless Client Issues</h4>
              <code>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints" type=signal_quality
| spath path=eventData.rssi output=rssi
| where rssi &lt; -70
| stats count, avg(rssi) AS avg_rssi by deviceName, client_mac
| sort avg_rssi</code>
            </div>
            <div class="query-card">
              <h4>Port Flapping Detection</h4>
              <code>index=fake_tshrt sourcetype="FAKE:meraki:switches" type=port_status
| spath path=eventData.port output=port
| spath path=eventData.status output=status
| stats count by deviceName, port
| where count &gt; 10
| sort - count</code>
            </div>
            <div class="query-card">
              <h4>Bandwidth Anomalies</h4>
              <code>index=fake_tshrt sourcetype="FAKE:cisco:asa"
| rex "bytes\s+(?&lt;bytes&gt;\d+)"
| timechart span=1h sum(bytes) AS total
| eventstats avg(total) AS avg_total, stdev(total) AS stdev_total
| where total &gt; avg_total + (2*stdev_total)
| table _time, total, avg_total</code>
            </div>
            <div class="query-card">
              <h4>Site-to-Site Traffic Analysis</h4>
              <code>index=fake_tshrt sourcetype="FAKE:cisco:asa"
| rex "for\s+\w+:(?&lt;src_ip&gt;10\.\d+\.\d+\.\d+).*to\s+\w+:(?&lt;dst_ip&gt;10\.\d+\.\d+\.\d+)"
| eval src_site=case(match(src_ip,"10\.10\."), "BOS", match(src_ip,"10\.20\."), "ATL", match(src_ip,"10\.30\."), "AUS")
| eval dst_site=case(match(dst_ip,"10\.10\."), "BOS", match(dst_ip,"10\.20\."), "ATL", match(dst_ip,"10\.30\."), "AUS")
| where src_site!=dst_site
| stats count by src_site, dst_site</code>
            </div>
            <div class="query-card">
              <h4>AP Association Failures</h4>
              <code>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints" type=disassociation
| stats count by deviceName, reason
| sort - count
| head 20</code>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 9: Network Summary -->
  <row>
    <panel>
      <title>Firewall Connection Summary</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa"
| eval action=case(
    match(_raw, "Built"), "Built",
    match(_raw, "Teardown"), "Teardown",
    match(_raw, "Deny"), "Deny",
    1=1, "Other")
| timechart span=1h count by action</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.fieldColors">{"Built": #5CC05C, "Teardown": #00bceb, "Deny": #dc4e41, "Other": #888}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
    <panel>
      <title>Client Distribution by Site</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:accesspoints" type=association
| eval site=case(
    match(deviceName, "BOS"), "Boston",
    match(deviceName, "ATL"), "Atlanta",
    match(deviceName, "AUS"), "Austin",
    1=1, "Unknown")
| where site!="Unknown"
| stats dc(client_mac) AS clients by site</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.fieldColors">{"Boston": #00bceb, "Atlanta": #5CC05C, "Austin": #f8be34}</option>
      </chart>
    </panel>
  </row>

</dashboard>
