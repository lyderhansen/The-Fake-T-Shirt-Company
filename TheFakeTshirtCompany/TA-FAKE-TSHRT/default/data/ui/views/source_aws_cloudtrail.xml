<dashboard version="1.1" theme="dark">
  <label>AWS CloudTrail</label>
  <description>AWS API activity logs from account 123456789012</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #1f2d1f 100%); border-radius: 8px; border-left: 4px solid #ff9900;">
          <h2 style="color: #ff9900; margin-top: 0;">AWS CloudTrail</h2>
          <p style="color: #ccc; font-size: 1.1em;">API activity logs from AWS account. Tracks user actions, API calls, and resource changes across AWS services.</p>
          <div style="display: flex; gap: 30px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Sourcetype:</span> <code style="color: #5CC05C;">FAKE:aws:cloudtrail</code>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Account:</span> <strong style="color: #fff;">123456789012</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Region:</span> <strong style="color: #fff;">us-east-1</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Format:</span> <strong style="color: #fff;">JSON</strong>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Events Over Time</title>
      <chart>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" by _time span=1h</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"count": 0xff9900}</option>
      </chart>
    </panel>
    <panel>
      <title>Top Event Sources</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"
| stats count by eventSource
| sort - count
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Total Events</title>
      <single>
        <search>
          <query>| tstats count where index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xff9900","0xff9900"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Unique Users</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" | stats dc(userIdentity.userName) AS users</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0x5CC05C"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Error Events</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" errorCode=* | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xdc4e41","0xdc4e41"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>IAM Events</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" eventSource="iam.amazonaws.com" | stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xf8be34","0xf8be34"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Key Fields</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Field</th>
              <th style="padding: 8px; text-align: left; border: 1px solid #444;">Description</th>
            </tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">eventTime</td><td style="padding: 8px; border: 1px solid #444;">Timestamp</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">eventSource</td><td style="padding: 8px; border: 1px solid #444;">AWS service (s3, iam, ec2, etc.)</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">eventName</td><td style="padding: 8px; border: 1px solid #444;">API action (GetObject, CreateUser, etc.)</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">userIdentity.userName</td><td style="padding: 8px; border: 1px solid #444;">User who performed action</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">sourceIPAddress</td><td style="padding: 8px; border: 1px solid #444;">IP of requester</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">errorCode</td><td style="padding: 8px; border: 1px solid #444;">Error if request failed</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">requestParameters</td><td style="padding: 8px; border: 1px solid #444;">API request details</td></tr>
            <tr><td style="padding: 8px; border: 1px solid #444; color: #5CC05C;">demo_id</td><td style="padding: 8px; border: 1px solid #444;">Scenario identifier</td></tr>
          </table>
        </div>
      </html>
    </panel>
    <panel>
      <title>Sensitive Resources</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <h4 style="color: #dc4e41; margin-top: 0;">S3 Buckets</h4>
          <ul style="color: #ccc; line-height: 2;">
            <li><code style="background: #333; padding: 2px 6px; border-radius: 3px;">faketshirtco-financial-reports</code> - Financial data</li>
            <li><code style="background: #333; padding: 2px 6px; border-radius: 3px;">faketshirtco-hr-documents</code> - HR records</li>
          </ul>

          <h4 style="color: #dc4e41; margin-top: 15px;">Backdoor User (Exfil Scenario)</h4>
          <p style="color: #ccc;"><code style="background: #333; padding: 2px 6px; border-radius: 3px;">svc-datasync</code> - Created with AdministratorAccess</p>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Top Event Names</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"
| stats count by eventName
| sort - count
| head 15</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Top Users</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"
| stats count by userIdentity.userName
| sort - count
| head 15</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>Events by Scenario</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" demo_id=*
| stats count by demo_id
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Use Cases</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #5CC05C; margin-top: 0;">Common SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">IAM User Creation</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" eventName=CreateUser
| table _time, userIdentity.userName, requestParameters.userName</pre>

          <h4 style="color: #ccc; margin-top: 20px;">S3 Data Access</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" eventSource="s3.amazonaws.com"
  (eventName=GetObject OR eventName=PutObject)
| stats count by eventName, requestParameters.bucketName</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Failed Requests</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" errorCode=*
| stats count by eventName, errorCode
| sort - count</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Policy Changes</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"
  (eventName=AttachUserPolicy OR eventName=PutUserPolicy)
| table _time, userIdentity.userName, requestParameters.*</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Sample Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail"
| table _time, eventSource, eventName, userIdentity.userName, sourceIPAddress, errorCode, demo_id
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
