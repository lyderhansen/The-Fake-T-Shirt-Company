<dashboard version="1.1" theme="dark">
  <label>Environmental Monitoring</label>
  <description>Monitor data center and server room temperature, humidity, and door access</description>

  <fieldset submitButton="false">
    <input type="time" token="time" searchWhenChanged="true">
      <label>Time Range</label>
      <default>
        <earliest>1735689600</earliest>
        <latest>1736899200</latest>
      </default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div style="padding: 20px; background: linear-gradient(135deg, #1a1a1a 0%, #2d1f2d 100%); border-radius: 8px; border-left: 4px solid #9954bb;">
          <h2 style="color: #9954bb; margin-top: 0;">Environmental Monitoring</h2>
          <p style="color: #ccc; font-size: 1.1em;">Monitor temperature (MT10), humidity (MT11), and door sensors (MT20) in server rooms and data centers. Water leak detection (MT14) for critical areas.</p>
          <div style="display: flex; gap: 20px; margin-top: 15px; flex-wrap: wrap;">
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #999;">Sourcetype:</span> <code style="color: #5CC05C;">FAKE:meraki:sensors</code>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #dc4e41;">Temp Alert:</span> <strong>&gt;28C Warning, &gt;32C Critical</strong>
            </div>
            <div style="background: #333; padding: 10px 15px; border-radius: 5px;">
              <span style="color: #f8be34;">Humidity:</span> <strong>40-55% Optimal</strong>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Avg Temperature</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=temperature
| stats avg(trigger.temperature.celsius) AS avg_temp
| eval avg_temp=round(avg_temp, 1)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[25,30]</option>
        <option name="useColors">1</option>
        <option name="unit">C</option>
      </single>
    </panel>
    <panel>
      <title>Temperature Alerts</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=temperature alertFired=true
| stats count AS temp_alerts</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x5CC05C","0xf8be34","0xdc4e41"]</option>
        <option name="rangeValues">[5,15]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Avg Humidity</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=humidity
| stats avg(trigger.humidity.value) AS avg_humidity
| eval avg_humidity=round(avg_humidity, 0)</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0xf8be34","0x5CC05C","0xf8be34"]</option>
        <option name="rangeValues">[40,55]</option>
        <option name="useColors">1</option>
        <option name="unit">%</option>
      </single>
    </panel>
    <panel>
      <title>Door Opens</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=door_open
| stats count AS door_opens</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="colorMode">block</option>
        <option name="rangeColors">["0x9954bb","0x9954bb"]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <row>
    <panel>
      <title>Data Center Temperature Over Time</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=temperature
| eval location=case(
    match(deviceSerial, "ATL-DC"), "Atlanta DC",
    match(deviceSerial, "BOS-MDF"), "Boston MDF",
    match(deviceSerial, "BOS-SVR"), "Boston Server Room",
    match(deviceSerial, "AUS"), "Austin",
    true(), "Other"
)
| timechart span=2h avg(trigger.temperature.celsius) by location</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.drilldown">none</option>
        <option name="height">300</option>
        <option name="charting.legend.placement">right</option>
        <option name="charting.fieldColors">{"Atlanta DC": 0x5CC05C, "Boston MDF": 0x00bceb, "Boston Server Room": 0xf8be34, "Austin": 0xdc4e41}</option>
        <option name="charting.axisTitleY.text">Temperature (C)</option>
        <option name="charting.chart.nullValueMode">connect</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Temperature by Sensor</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=temperature
| stats latest(trigger.temperature.celsius) AS current_temp, avg(trigger.temperature.celsius) AS avg_temp, max(trigger.temperature.celsius) AS max_temp, latest(_time) AS last_reading by deviceSerial
| eval current_temp=round(current_temp, 1), avg_temp=round(avg_temp, 1), max_temp=round(max_temp, 1)
| eval status=case(current_temp&gt;32, "CRITICAL", current_temp&gt;28, "Warning", true(), "Normal")
| eval last_reading=strftime(last_reading, "%Y-%m-%d %H:%M")
| sort - current_temp
| table deviceSerial, current_temp, avg_temp, max_temp, status, last_reading
| rename deviceSerial AS "Sensor", current_temp AS "Current (C)", avg_temp AS "Avg (C)", max_temp AS "Max (C)", status AS "Status", last_reading AS "Last Reading"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
      </table>
    </panel>
    <panel>
      <title>Sensor Locations</title>
      <html>
        <div style="background: #1a1a1a; padding: 15px; border-radius: 5px;">
          <h4 style="color: #9954bb; margin-top: 0;">MT Sensor Inventory (14 total)</h4>
          <table style="width: 100%; border-collapse: collapse;">
            <tr style="background: #2a2a2a;">
              <th style="padding: 6px; text-align: left; border: 1px solid #444;">Location</th>
              <th style="padding: 6px; text-align: left; border: 1px solid #444;">Area</th>
              <th style="padding: 6px; text-align: left; border: 1px solid #444;">Sensors</th>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #00bceb;">Boston</td>
              <td style="padding: 6px; border: 1px solid #444;">Server Room</td>
              <td style="padding: 6px; border: 1px solid #444;">Temp, Door</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #00bceb;">Boston</td>
              <td style="padding: 6px; border: 1px solid #444;">MDF Room</td>
              <td style="padding: 6px; border: 1px solid #444;">Temp, Humidity, Door</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #5CC05C;">Atlanta</td>
              <td style="padding: 6px; border: 1px solid #444;">DC Row A</td>
              <td style="padding: 6px; border: 1px solid #444;">Temp, Humidity</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #5CC05C;">Atlanta</td>
              <td style="padding: 6px; border: 1px solid #444;">DC Row B</td>
              <td style="padding: 6px; border: 1px solid #444;">Temp, Humidity</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #5CC05C;">Atlanta</td>
              <td style="padding: 6px; border: 1px solid #444;">DC Floor</td>
              <td style="padding: 6px; border: 1px solid #444;">Water Leak</td>
            </tr>
            <tr>
              <td style="padding: 6px; border: 1px solid #444; color: #f8be34;">Austin</td>
              <td style="padding: 6px; border: 1px solid #444;">Server Room</td>
              <td style="padding: 6px; border: 1px solid #444;">Temp</td>
            </tr>
          </table>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>Humidity Trends</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=humidity
| timechart span=4h avg(trigger.humidity.value) AS "Humidity %"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.fieldColors">{"Humidity %": 0x00bceb}</option>
        <option name="charting.axisTitleY.text">Humidity %</option>
      </chart>
    </panel>
    <panel>
      <title>Humidity by Sensor</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=humidity
| stats latest(trigger.humidity.value) AS current_humidity, avg(trigger.humidity.value) AS avg_humidity by deviceSerial
| eval current_humidity=round(current_humidity, 0), avg_humidity=round(avg_humidity, 0)
| eval status=case(current_humidity&lt;30 OR current_humidity&gt;70, "Out of Range", current_humidity&lt;40 OR current_humidity&gt;55, "Suboptimal", true(), "Optimal")
| sort - current_humidity
| rename deviceSerial AS "Sensor", current_humidity AS "Current %", avg_humidity AS "Avg %", status AS "Status"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Door Access Log (Server Rooms &amp; Data Centers)</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" (type=door_open OR type=door_close)
| eval event=if(type="door_open", "OPEN", "CLOSE")
| table _time, deviceSerial, event
| sort - _time
| head 30
| rename deviceSerial AS "Sensor", event AS "Event"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">15</option>
      </table>
    </panel>
    <panel>
      <title>Door Events Timeline</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" (type=door_open OR type=door_close)
| timechart span=4h count by type</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.drilldown">none</option>
        <option name="height">250</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.fieldColors">{"door_open": 0x5CC05C, "door_close": 0x9954bb}</option>
      </chart>
    </panel>
  </row>

  <row>
    <panel>
      <title>Alert Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" alertFired=true
| table _time, deviceSerial, type, trigger.metric, trigger.temperature.celsius, trigger.humidity.value
| sort - _time
| head 20
| rename deviceSerial AS "Sensor", trigger.metric AS "Metric", trigger.temperature.celsius AS "Temp (C)", trigger.humidity.value AS "Humidity %"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
    <panel>
      <title>Water Leak Detection</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=water_leak
| table _time, deviceSerial, trigger.waterDetection.detected
| sort - _time
| head 10
| rename deviceSerial AS "Sensor", trigger.waterDetection.detected AS "Water Detected"</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

  <row>
    <panel>
      <title>Investigation Queries</title>
      <html>
        <div style="background: #1a1a1a; padding: 20px; border-radius: 5px;">
          <h3 style="color: #9954bb; margin-top: 0;">Useful SPL Queries</h3>

          <h4 style="color: #ccc; margin-top: 20px;">Temperature Threshold Alerts</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=temperature trigger.temperature.celsius&gt;28
| table _time, deviceSerial, trigger.temperature.celsius, alertFired</pre>

          <h4 style="color: #ccc; margin-top: 20px;">After-Hours Door Activity</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=door_open
| eval hour=strftime(_time, "%H")
| where hour &gt;= "20" OR hour &lt;= "06"
| table _time, deviceSerial, hour</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Humidity Out of Range</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt sourcetype="FAKE:meraki:sensors" type=sensor_reading trigger.metric=humidity
| where trigger.humidity.value &lt; 30 OR trigger.humidity.value &gt; 70
| table _time, deviceSerial, trigger.humidity.value</pre>

          <h4 style="color: #ccc; margin-top: 20px;">Temperature vs Occupancy Correlation</h4>
          <pre style="background: #0d0d0d; padding: 10px; border-radius: 3px; overflow-x: auto; color: #5CC05C;">index=fake_tshrt (sourcetype="FAKE:meraki:sensors" trigger.metric=temperature)
  OR (sourcetype="FAKE:cisco:webex:events" event_type=room_analytics)
| timechart span=30m avg(trigger.temperature.celsius) AS temp, avg(people_count) AS people</pre>
        </div>
      </html>
    </panel>
  </row>

  <row>
    <panel>
      <title>All Sensor Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:sensors"
| table _time, deviceSerial, type, trigger.metric, trigger.temperature.celsius, trigger.humidity.value, alertFired
| sort - _time
| head 25</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>
</dashboard>
