<dashboard version="1.1" theme="dark">
  <label>Security Operations Discovery</label>
  <description>SOC-focused overview of authentication, threats, and security incidents</description>

  <fieldset submitButton="false">
    <input type="time" token="time">
      <label>Time Range</label>
      <default>
        <earliest>1736726400</earliest>
        <latest>1736899199</latest>
      </default>
    </input>
    <input type="dropdown" token="location">
      <label>Location</label>
      <choice value="*">All Locations</choice>
      <choice value="BOS">Boston</choice>
      <choice value="ATL">Atlanta</choice>
      <choice value="AUS">Austin</choice>
      <default>*</default>
    </input>
  </fieldset>

  <!-- Row 1: Header -->
  <row>
    <panel>
      <html>
        <style>
          .security-header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            border-left: 4px solid #dc4e41;
            padding: 20px 25px;
            border-radius: 8px;
            margin: -10px;
          }
          .security-header h1 {
            color: #dc4e41;
            margin: 0 0 10px 0;
            font-size: 24px;
            font-weight: 600;
          }
          .security-header p {
            color: #a0a0a0;
            margin: 5px 0;
            font-size: 13px;
          }
          .threat-indicator {
            display: inline-block;
            background: rgba(220, 78, 65, 0.2);
            border: 1px solid #dc4e41;
            padding: 5px 12px;
            border-radius: 4px;
            margin-top: 10px;
          }
          .threat-indicator span {
            color: #dc4e41;
            font-weight: 600;
          }
        </style>
        <div class="security-header">
          <h1>Security Operations Discovery</h1>
          <p><strong>Data Sources:</strong> Entra ID Sign-in/Risk | Windows Security Events | Cisco ASA | Meraki IDS | AWS CloudTrail | GCP Audit</p>
          <p><strong>Attack Scenarios:</strong> APT Data Exfiltration (14-day campaign) | Ransomware Detection</p>
          <div class="threat-indicator">
            <span>Known Threat IP: 185.220.101.42 (Frankfurt, DE)</span>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 2: Security KPIs -->
  <row>
    <panel>
      <title>Security Score</title>
      <single>
        <search>
          <query>index=fake_tshrt (sourcetype="FAKE:azure:aad:signin" OR sourcetype="FAKE:cisco:asa")
| eval is_failure=if(sourcetype="FAKE:azure:aad:signin" AND 'status.errorCode'!=0, 1, 0)
| eval is_denial=if(sourcetype="FAKE:cisco:asa" AND (match(_raw, "Deny") OR match(_raw, "denied")), 1, 0)
| stats sum(is_failure) AS failures, sum(is_denial) AS denials, count AS total
| eval failure_rate=round((failures+denials)/total*100, 2)
| eval score=round(100-failure_rate, 0)
| eval score=if(score&lt;0, 0, score)
| table score</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="numberPrecision">0</option>
        <option name="rangeColors">["#dc4e41","#f8be34","#5CC05C"]</option>
        <option name="rangeValues">[60,85]</option>
        <option name="unit">%</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Failed Logins (24h)</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=status.errorCode output=errorCode
| where errorCode!=0
| stats count</query>
          <earliest>-24h@h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[20,50]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Firewall Denials</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" ("Deny" OR "denied")
| stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[100,500]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Risk Detections</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:risk:detection"
| stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[1,5]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>IDS Alerts</title>
      <single>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=security_event
| stats count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#5CC05C","#f8be34","#dc4e41"]</option>
        <option name="rangeValues">[1,10]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel>
      <title>Active Threats</title>
      <single>
        <search>
          <query>index=fake_tshrt demo_id=exfil
| stats dc(sourcetype) AS sources, count AS events
| eval status=if(events&gt;0, events." events", "None")
| table status</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">none</option>
        <option name="rangeColors">["#5CC05C","#dc4e41"]</option>
        <option name="rangeValues">[0]</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>

  <!-- Row 3: Authentication Analysis -->
  <row>
    <panel>
      <title>Authentication Success/Failure Over Time</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=status.errorCode output=errorCode
| eval status=if(errorCode=0, "Success", "Failure")
| timechart span=1h count by status</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.fieldColors">{"Success": #5CC05C, "Failure": #dc4e41}</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
    <panel>
      <title>Failed Logins by User (Top 10)</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=status.errorCode output=errorCode
| where errorCode!=0
| spath path=userPrincipalName output=user
| rex field=user "(?&lt;username&gt;[^@]+)"
| stats count by username
| sort - count
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.fieldColors">{"count": #dc4e41}</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
      </chart>
    </panel>
  </row>

  <!-- Row 4: Threat Detection -->
  <row>
    <panel>
      <title>Firewall Denials by Source IP</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:cisco:asa" ("Deny" OR "denied")
| rex "(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+)/\d+"
| stats count by src_ip
| sort - count
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">bar</option>
        <option name="charting.fieldColors">{"count": #f8be34}</option>
        <option name="charting.legend.placement">none</option>
      </chart>
    </panel>
    <panel>
      <title>Security Events by Type</title>
      <chart>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:meraki:securityappliances" type=security_event
| spath path=eventData.signature output=signature
| spath path=eventData.priority output=priority
| eval event_type=coalesce(signature, "Unknown")
| stats count by event_type
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.fieldColors">{"high": #dc4e41, "medium": #f8be34, "low": #5CC05C}</option>
      </chart>
    </panel>
  </row>

  <!-- Row 5: Attack Indicators -->
  <row>
    <panel>
      <title>Suspicious Activity Timeline</title>
      <chart>
        <search>
          <query>index=fake_tshrt (sourcetype="FAKE:azure:aad:risk:detection" OR (sourcetype="FAKE:cisco:asa" src_ip="185.220.101.42") OR demo_id=exfil)
| eval event_type=case(
    sourcetype="FAKE:azure:aad:risk:detection", "Risk Detection",
    match(_raw, "185.220.101.42"), "Threat IP Activity",
    demo_id="exfil", "Exfil Scenario",
    1=1, "Other")
| timechart span=4h count by event_type</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">line</option>
        <option name="charting.fieldColors">{"Risk Detection": #dc4e41, "Threat IP Activity": #f8be34, "Exfil Scenario": #9954bb}</option>
        <option name="charting.legend.placement">bottom</option>
      </chart>
    </panel>
    <panel>
      <title>Login Locations (Potential Impossible Travel)</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=location.city output=city
| spath path=location.countryOrRegion output=country
| spath path=userPrincipalName output=user
| eval location=city.", ".country
| stats count, dc(location) AS unique_locations, values(location) AS locations by user
| where unique_locations &gt; 1
| sort - unique_locations
| head 10
| table user, unique_locations, locations, count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="unique_locations">
          <colorPalette type="list">[#5CC05C,#f8be34,#dc4e41]</colorPalette>
          <scale type="threshold">1,3</scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 6: Alerting Tables -->
  <row>
    <panel>
      <title>Risk Detection Events</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:azure:aad:risk:detection"
| spath path=riskEventType output=riskEventType
| spath path=riskLevel output=riskLevel
| spath path=userPrincipalName output=user
| spath path=detectedDateTime output=detected
| rex field=user "(?&lt;username&gt;[^@]+)"
| table _time, username, riskEventType, riskLevel
| sort - _time
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="riskLevel">
          <colorPalette type="map">{"high":#dc4e41,"medium":#f8be34,"low":#5CC05C}</colorPalette>
        </format>
      </table>
    </panel>
    <panel>
      <title>Recent Security Incidents (ServiceNow)</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:servicenow:incident" (category="*Security*" OR category="*security*" OR short_description="*security*" OR short_description="*unauthorized*" OR short_description="*breach*")
| rex field=_raw "number=\"(?&lt;number&gt;[^\"]+)\""
| rex field=_raw "priority=\"(?&lt;priority&gt;[^\"]+)\""
| rex field=_raw "state=\"(?&lt;state&gt;[^\"]+)\""
| rex field=_raw "short_description=\"(?&lt;description&gt;[^\"]+)\""
| table _time, number, priority, state, description
| sort - _time
| head 10</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="priority">
          <colorPalette type="map">{"1":#dc4e41,"2":#f8be34,"3":#5CC05C,"4":#00bceb}</colorPalette>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 7: Investigation Queries -->
  <row>
    <panel>
      <html>
        <style>
          .investigation-queries {
            background: #1a1a2e;
            border-radius: 8px;
            padding: 20px;
          }
          .investigation-queries h3 {
            color: #dc4e41;
            margin-top: 0;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
          }
          .query-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
          }
          .query-card {
            background: #16213e;
            border-radius: 6px;
            padding: 15px;
            border-left: 3px solid #dc4e41;
          }
          .query-card h4 {
            color: #e0e0e0;
            margin: 0 0 8px 0;
            font-size: 14px;
          }
          .query-card code {
            display: block;
            background: #0d1421;
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            color: #888;
            overflow-x: auto;
            white-space: pre-wrap;
          }
        </style>
        <div class="investigation-queries">
          <h3>Security Investigation Queries</h3>
          <div class="query-grid">
            <div class="query-card">
              <h4>Failed Login Analysis</h4>
              <code>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=status.errorCode output=errorCode
| where errorCode!=0
| stats count by userPrincipalName, ipAddress
| sort - count</code>
            </div>
            <div class="query-card">
              <h4>Impossible Travel Detection</h4>
              <code>index=fake_tshrt sourcetype="FAKE:azure:aad:signin"
| spath path=location.city output=city
| spath path=userPrincipalName output=user
| stats earliest(_time) AS first, latest(_time) AS last,
  values(city) AS cities by user
| where mvcount(cities) &gt; 1</code>
            </div>
            <div class="query-card">
              <h4>Privilege Escalation</h4>
              <code>index=fake_tshrt sourcetype="FAKE:WinEventLog" EventCode=4672
| stats count by Account_Name, ComputerName
| sort - count</code>
            </div>
            <div class="query-card">
              <h4>Data Exfiltration Indicators</h4>
              <code>index=fake_tshrt sourcetype="FAKE:cisco:asa" demo_id=exfil
| rex "bytes\s+(?&lt;bytes&gt;\d+)"
| stats sum(bytes) AS total_bytes by src_ip, dst_ip
| where total_bytes &gt; 10000000
| sort - total_bytes</code>
            </div>
            <div class="query-card">
              <h4>Port Scan Detection</h4>
              <code>index=fake_tshrt sourcetype="FAKE:cisco:asa" "Deny"
| rex "(?&lt;src_ip&gt;\d+\.\d+\.\d+\.\d+).*?/(?&lt;dport&gt;\d+)"
| stats dc(dport) AS ports_scanned by src_ip
| where ports_scanned &gt; 20
| sort - ports_scanned</code>
            </div>
            <div class="query-card">
              <h4>Cross-Source Correlation</h4>
              <code>index=fake_tshrt (sourcetype="FAKE:azure:aad:signin" OR sourcetype="FAKE:cisco:asa" OR sourcetype="FAKE:aws:cloudtrail")
| eval user=coalesce(userPrincipalName, userName, 'userIdentity.userName')
| stats count by sourcetype, user
| sort user</code>
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Row 8: Attack Scenario Status -->
  <row>
    <panel>
      <title>Exfil Scenario Timeline (by Sourcetype)</title>
      <chart>
        <search>
          <query>index=fake_tshrt demo_id=exfil
| timechart span=1d count by sourcetype</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
      </chart>
    </panel>
    <panel>
      <title>Compromised Account Activity</title>
      <table>
        <search>
          <query>index=fake_tshrt (sourcetype="FAKE:azure:aad:signin" OR sourcetype="FAKE:aws:cloudtrail" OR sourcetype="FAKE:cisco:asa")
| eval user=coalesce(userPrincipalName, 'userIdentity.userName')
| search user IN ("jessica.brown@theFakeTshirtCompany.com", "alex.miller@theFakeTshirtCompany.com", "jessica.brown", "alex.miller")
| rex field=user "(?&lt;username&gt;[^@]+)"
| stats count, dc(sourcetype) AS sources, values(sourcetype) AS data_sources by username
| eval role=case(
    username="jessica.brown", "Initial Compromise (ATL IT Admin)",
    username="alex.miller", "Primary Target (BOS Finance)",
    1=1, "Unknown")
| table username, role, count, sources, data_sources
| sort - count</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
        <format type="color" field="count">
          <colorPalette type="minMidMax" maxColor="#dc4e41" midColor="#f8be34" minColor="#5CC05C"></colorPalette>
          <scale type="minMidMax" midType="percentile" midValue="50"></scale>
        </format>
      </table>
    </panel>
  </row>

  <!-- Row 9: Threat Actor Analysis -->
  <row>
    <panel>
      <title>Threat IP Activity (185.220.101.42)</title>
      <table>
        <search>
          <query>index=fake_tshrt "185.220.101.42"
| stats count, values(sourcetype) AS sources, earliest(_time) AS first_seen, latest(_time) AS last_seen
| eval first_seen=strftime(first_seen, "%Y-%m-%d %H:%M:%S")
| eval last_seen=strftime(last_seen, "%Y-%m-%d %H:%M:%S")
| table first_seen, last_seen, count, sources</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
      </table>
    </panel>
    <panel>
      <title>AWS Suspicious API Calls</title>
      <table>
        <search>
          <query>index=fake_tshrt sourcetype="FAKE:aws:cloudtrail" (eventName="CreateUser" OR eventName="CreateAccessKey" OR eventName="PutUserPolicy" OR eventName="CreateLoginProfile")
| spath path=userIdentity.userName output=user
| spath path=eventName output=action
| spath path=sourceIPAddress output=src_ip
| table _time, user, action, src_ip
| sort - _time
| head 20</query>
          <earliest>$time.earliest$</earliest>
          <latest>$time.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="count">10</option>
      </table>
    </panel>
  </row>

</dashboard>
