#
# local/props.conf for TA-FAKE-TSHRT
#
# CIM field enrichment from real Splunk TAs.
# Source: Supporting TA downloads (Splunkbase).
# ONLY adds new EVAL/FIELDALIAS/LOOKUP attributes — never redefines default/ attributes.
#

##############################################################################################################
# WINDOWS - CIM Field Enrichment (Phase 2)
# Source: Splunk_TA_windows v9.x (Splunkbase #742)
# Adds CIM fields for Authentication, Endpoint, Change data models.
# Our events use KV format (not XML), so field names use underscores from KV_MODE=AUTO.
##############################################################################################################

[FAKE:WinEventLog]

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-dest_nt_host = ComputerName AS dest_nt_host
FIELDALIAS-severity_id = EventType AS severity_id
FIELDALIAS-body = Message AS body
FIELDALIAS-event_id = RecordNumber AS event_id
FIELDALIAS-id = RecordNumber AS id
FIELDALIAS-user_id = User_ID AS user_id
FIELDALIAS-service_name = Service_Name AS service, Service_Name AS service_name
FIELDALIAS-parent_process = Creator_Process_Name AS parent_process

# --- CIM EVAL Statements (new, not in default/) ---

# Vendor/product (split fields for CIM)
EVAL-vendor = "Microsoft"
EVAL-product = "Windows"

# Destination: ComputerName is always the dest for WinEventLog
EVAL-dest = ComputerName

# Source: Map based on EventCode (auth events use Source_Network_Address or IpAddress)
EVAL-src = case( \
    EventCode IN (4624,4625), coalesce(Source_Network_Address, IpAddress, Workstation_Name), \
    EventCode==4776, Workstation, \
    EventCode==4778, Client_Address, \
    EventCode IN (4672,4706,4713), ComputerName, \
    true(), src)

# Authentication method (Logon_Type to human-readable)
EVAL-authentication_method = case( \
    EventCode IN (4624,4625), Logon_Type, \
    true(), authentication_method)

# Authentication service (package name)
EVAL-authentication_service = case( \
    EventCode IN (4624,4625), Authentication_Package_Name, \
    true(), authentication_service)

# Process fields for EventCode 4688 (new process creation)
EVAL-process_name = case( \
    EventCode==4688, replace(New_Process_Name, ".*\\\\", ""), \
    true(), process_name)
EVAL-process_path = case( \
    EventCode==4688, New_Process_Name, \
    true(), process_path)
EVAL-process = case( \
    EventCode==4688, coalesce(Process_Command_Line, New_Process_Name), \
    true(), process)

# Parent process for 4688
EVAL-parent_process_name = case( \
    EventCode==4688, replace(Creator_Process_Name, ".*\\\\", ""), \
    true(), parent_process_name)

# Keywords normalization
EVAL-result_id = Keywords


##############################################################################################################
# SYSMON - CIM Field Enrichment (Phase 2)
# Source: Splunk_TA_microsoft_sysmon v4.x (Splunkbase #5765)
# Adds CIM fields for Endpoint (Processes, Filesystem, Registry), Network Traffic, DNS data models.
# Our events use KV format — fields extracted by REPORT transforms in default/props.conf.
##############################################################################################################

[FAKE:WinEventLog:Sysmon]

# --- CIM Field Aliases (new or enhanced from default/) ---
FIELDALIAS-dvc = ComputerName AS dvc
FIELDALIAS-src_port = SourcePort AS src_port
FIELDALIAS-query = QueryName AS query
FIELDALIAS-reply_code_id = QueryStatus AS reply_code_id
FIELDALIAS-registry_path_alias = TargetObject AS registry_path
FIELDALIAS-granted_access = GrantedAccess AS granted_access
FIELDALIAS-process_integrity_level = IntegrityLevel AS process_integrity_level
FIELDALIAS-eventid = EventCode AS EventID

# --- CIM EVAL Statements ---

# Action classification by EventCode
EVAL-action = case( \
    EventCode IN ("1","3","7","8","10"), "allowed", \
    EventCode=="5", "allowed", \
    EventCode=="11", "created", \
    EventCode IN ("13","14"), "modified", \
    EventCode=="22", "allowed", \
    true(), "unknown")

# Destination mapping
EVAL-dest = case( \
    EventCode=="3" AND isnotnull(DestinationHostname) AND DestinationHostname!="-", DestinationHostname, \
    EventCode=="3", DestinationIp, \
    true(), ComputerName)

# Source mapping
EVAL-src = case( \
    EventCode=="3" AND isnotnull(SourceHostname) AND SourceHostname!="-", SourceHostname, \
    EventCode IN ("22") AND isnotnull(ComputerName), ComputerName, \
    true(), SourceIp)

# Process path (CIM: process_path)
EVAL-process_path = case( \
    EventCode IN ("1","3","5","11","13","22"), Image, \
    EventCode=="7", ImageLoaded, \
    true(), Image)

# Process name (extract exe from full path)
EVAL-process_name = case( \
    EventCode IN ("1","3","5","7","11","13","22"), replace(Image, ".*\\\\", ""), \
    true(), replace(Image, ".*\\\\", ""))

# Process ID
EVAL-process_id = ProcessId

# Process GUID
EVAL-process_guid = ProcessGuid

# Process (command line for EID 1, Image for others)
EVAL-process_exec = case( \
    EventCode=="1", CommandLine, \
    true(), Image)

# Parent process fields (EventCode 1 only)
EVAL-parent_process_path = case(EventCode=="1", ParentImage)
EVAL-parent_process_name = case(EventCode=="1", replace(ParentImage, ".*\\\\", ""))
EVAL-parent_process_id = case(EventCode=="1", ParentProcessId)

# File path and file name (EventCode 11 — FileCreate)
EVAL-file_path = case( \
    EventCode=="11", replace(TargetFilename, "(:[\w\\. ]+)", ""), \
    true(), null())
EVAL-file_name = case( \
    EventCode=="11", replace(TargetFilename, ".*\\\\", ""), \
    true(), null())

# Registry fields (EventCode 13 — Registry Value Set)
EVAL-registry_key_name = case( \
    EventCode=="13", replace(TargetObject, ".*\\\\", ""), \
    true(), null())
EVAL-registry_value_name = case( \
    EventCode=="13", replace(TargetObject, ".*\\\\([^)]+|\\(Default\\))$", "\\1"), \
    true(), null())

# Network fields (EventCode 3)
EVAL-app = case(EventCode=="3", Image)
EVAL-direction = case( \
    EventCode=="3" AND Initiated=="true", "outbound", \
    EventCode=="3", "inbound")
EVAL-protocol = case(EventCode=="3", "ip")
EVAL-state = case(EventCode=="3", "established")
EVAL-transport = Protocol

# User extraction (strip domain prefix)
EVAL-user = case( \
    isnotnull(User) AND User!="-", replace(User, ".*\\\\", ""), \
    true(), User)

# Object category for CIM
EVAL-object_category = case( \
    EventCode=="11", "file", \
    EventCode IN ("12","13","14"), "registry", \
    true(), null())

# OS field
EVAL-os = "Microsoft Windows"

# Status field
EVAL-status = case( \
    EventCode=="255", "critical", \
    true(), "success")

# Sysmon EventCode lookup
LOOKUP-eventcode = sysmon_eventcode_lookup EventCode OUTPUTNEW EventDescription, EventDescription AS signature

# DNS record type lookup (EventCode 22)
LOOKUP-record_type = sysmon_record_type_lookup record_type_id OUTPUTNEW record_type_name AS record_type


##############################################################################################################
# AWS CLOUDTRAIL - CIM Field Enrichment (Phase 3)
# Source: Splunk_TA_aws v7.x (Splunkbase #1876)
# Adds CIM fields for Authentication, Change, Cloud data models.
# default/props.conf has: FIELDALIAS user, src, action, dest(=awsRegion), EVAL vendor_product, app
# This stanza adds new FIELDALIAS + EVAL + LOOKUP attributes only.
# EVAL-dest and EVAL-user override the default/ FIELDALIAS (EVAL takes precedence in Splunk).
##############################################################################################################

[FAKE:aws:cloudtrail]

# --- CIM Field Aliases (new, not in default/) ---

# Non-CIM utility aliases
FIELDALIAS-requestParameters_desc = requestParameters AS desc
FIELDALIAS-eventTime_start_time = eventTime AS start_time
FIELDALIAS-temp_access_key = responseElements.credentials.accessKeyId AS temp_access_key
FIELDALIAS-user_access_key = userIdentity.accessKeyId AS user_access_key

# Common CIM
FIELDALIAS-app_type = eventType AS app
FIELDALIAS-dvc = eventSource AS dvc
FIELDALIAS-region = awsRegion AS region
FIELDALIAS-signature = eventName AS signature
FIELDALIAS-src_ip = sourceIPAddress AS src_ip
FIELDALIAS-user_group_id = userIdentity.accountId AS user_group_id
FIELDALIAS-vendor_region = awsRegion AS vendor_region

# Authentication CIM
FIELDALIAS-reason = errorMessage AS reason

# Change CIM
FIELDALIAS-command = eventName AS command
FIELDALIAS-image_id = requestParameters.instancesSet.items{}.imageId AS image_id
FIELDALIAS-instance_type = requestParameters.instanceType AS instance_type
FIELDALIAS-result_id = errorCode AS result_id

# --- CIM EVAL Statements ---

# Error/success message
EVAL-msg = coalesce(errorCode, "success")

# User ARN (full ARN for correlation)
EVAL-user_arn = coalesce('userIdentity.arn', 'requestParameters.roleArn')

# Display name (human-readable user name)
EVAL-userName = coalesce('userIdentity.userName', 'requestParameters.sourceIdentity', \
    'userIdentity.sessionContext.sessionIssuer.userName', \
    if(isnull('userIdentity.arn'), \
        mvindex(split(mvindex(split('requestParameters.roleArn', ":"), -1), "/"), -1), \
        mvindex(split(mvindex(split('userIdentity.arn', ":"), -1), "/"), -1)))

# Result message
EVAL-result = errorMessage

# AWS account ID
EVAL-vendor_account = coalesce('userIdentity.accountId', recipientAccountId)

# CIM user field (overrides FIELDALIAS-user from default/ — EVAL takes precedence)
# Simplified for our 19 eventNames, adapted from real TA's 60+ line CASE
EVAL-user = case( \
    eventName="CreateAccessKey", coalesce('responseElements.accessKey.userName', 'userIdentity.userName'), \
    eventName="DeleteAccessKey", 'userIdentity.userName', \
    eventName="AssumeRole" AND 'userIdentity.type'="AssumedRole", \
        coalesce(mvindex(split('requestParameters.roleArn', "/"), -1), 'userIdentity.sessionContext.sessionIssuer.userName'), \
    eventName="AssumeRole", \
        mvindex(split('responseElements.assumedRoleUser.arn', "/"), -1), \
    eventName="ConsoleLogin" AND 'userIdentity.type'="AssumedRole", \
        coalesce(mvindex(split('userIdentity.principalId', ":"), 1), 'userIdentity.userName'), \
    eventName="ConsoleLogin", \
        coalesce('userIdentity.userName', 'userIdentity.sessionContext.sessionIssuer.userName'), \
    eventName IN ("RunInstances","TerminateInstances","PutObject","GetObject","DeleteObject"), \
        coalesce('userIdentity.userName', 'userIdentity.sessionContext.sessionIssuer.userName'), \
    eventName="GetSecretValue", \
        coalesce(mvindex(split('userIdentity.principalId', ":"), 1), 'userIdentity.sessionContext.sessionIssuer.userName', 'userIdentity.userName'), \
    true(), 'userIdentity.userName')

# CIM user_name
EVAL-user_name = coalesce('userIdentity.userName', \
    'userIdentity.sessionContext.sessionIssuer.userName', \
    if(isnull('userIdentity.arn'), \
        mvindex(split(mvindex(split('requestParameters.roleArn', ":"), -1), "/"), -1), \
        mvindex(split(mvindex(split('userIdentity.arn', ":"), -1), "/"), -1)))

# CIM user_id
EVAL-user_id = case( \
    eventName="ConsoleLogin" AND 'userIdentity.type'="IAMUser", \
        coalesce(mvindex(split('userIdentity.principalId', ":"), 0), 'userIdentity.accountId'), \
    eventName="ConsoleLogin" AND 'userIdentity.type'="AssumedRole", \
        coalesce(mvindex(split('userIdentity.sessionContext.sessionIssuer.principalId', ":"), 0), mvindex(split('userIdentity.principalId', ":"), 0)), \
    eventType="AwsApiCall", \
        mvindex(split('responseElements.assumedRoleUser.assumedRoleId', ":"), 0), \
    true(), 'userIdentity.userName')

# CIM user_type
EVAL-user_type = 'userIdentity.type'

# User agent normalization
EVAL-user_agent = coalesce(userAgent, 'userAgent{}')

# AWS account ID for Authentication CIM
EVAL-aws_account_id = if('userIdentity.type'="AWSAccount" OR 'userIdentity.type'="AWSService", \
    recipientAccountId, 'userIdentity.accountId')

# CIM dest field (overrides FIELDALIAS-dest from default/ — EVAL takes precedence)
# default/ maps dest=awsRegion which is wrong for many events
EVAL-dest = case( \
    eventName="RunInstances", coalesce('responseElements.instancesSet.items{}.instanceId', eventSource), \
    eventName="TerminateInstances", 'requestParameters.instancesSet.items{}.instanceId', \
    eventName IN ("PutObject","GetObject","DeleteObject"), \
        coalesce('requestParameters.host{}', 'requestParameters.Host'), \
    eventName="ConsoleLogin" OR eventName="AssumeRole", \
        coalesce('additionalEventData.LoginTo', eventSource), \
    true(), eventSource)

# CIM object field (resource being acted upon)
EVAL-object = case( \
    eventName IN ("GetObject","PutObject","DeleteObject"), 'requestParameters.bucketName', \
    eventName="DescribeInstances", "Instance", \
    eventName="RunInstances", coalesce('responseElements.instancesSet.items{}.instanceId', eventSource), \
    eventName="TerminateInstances", coalesce('requestParameters.instancesSet.items{}.instanceId', eventSource), \
    eventName="CreateAccessKey", coalesce('responseElements.accessKey.userName', 'userIdentity.userName'), \
    eventName="DeleteAccessKey", 'requestParameters.userName', \
    eventName="GetSecretValue", 'requestParameters.secretId', \
    eventName="Invoke", 'requestParameters.functionName', \
    eventName="AssumeRole", mvindex(split('requestParameters.roleArn', "/"), -1), \
    eventName="ListUsers", "IAM Users", \
    eventName="DescribeAlarms", 'requestParameters.alarmNames{}', \
    eventName="SetAlarmState", 'requestParameters.alarmName', \
    eventName="PutLogEvents", 'requestParameters.logGroupName', \
    true(), eventName)

# CIM object_id (resource identifier)
EVAL-object_id = case( \
    eventName IN ("GetObject","PutObject","DeleteObject"), 'requestParameters.key', \
    eventName="RunInstances", coalesce('responseElements.instancesSet.items{}.instanceId', eventSource), \
    eventName="TerminateInstances", 'requestParameters.instancesSet.items{}.instanceId', \
    eventName="CreateAccessKey", 'responseElements.accessKey.accessKeyId', \
    eventName="DeleteAccessKey", 'requestParameters.accessKeyId', \
    eventName="GetSecretValue", 'resources{}.ARN', \
    eventName="Invoke", 'requestParameters.functionName', \
    eventName="AssumeRole", 'requestParameters.roleArn', \
    true(), null())

# --- Lookups ---

# Action and status from eventName + errorCode (WILDCARD match on errorCode)
LOOKUP-action_status = aws_cloudtrail_action_status_lookup eventName errorCode OUTPUTNEW action status

# Object category from eventName
LOOKUP-object_category = aws_cloudtrail_eventname_lookup eventName OUTPUTNEW object_category

# Change type from eventSource (general)
LOOKUP-changetype_source = aws_cloudtrail_changetype_lookup eventSource OUTPUTNEW change_type

# Change type from eventName (specific, overrides source-based)
LOOKUP-changetype_eventname = aws_cloudtrail_eventname_changetype_lookup eventName OUTPUTNEW change_type


##############################################################################################################
# ENTRA ID Sign-in - CIM Field Enrichment (Phase 4)
# Source: Splunk_TA_microsoft-cloudservices v5.x (Splunkbase #3110)
# default/ has: FIELDALIAS-src, EVAL-vendor_product, EVAL-action, EVAL-app, EVAL-dest, EVAL-duration,
#               EVAL-user, EVAL-user_id, LOOKUP-asset, LOOKUP-identity
# This stanza adds NEW FIELDALIAS + EVAL + LOOKUP attributes only.
##############################################################################################################

[FAKE:azure:aad:signin]

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-src_ip = callerIpAddress AS src_ip
FIELDALIAS-signature = operationName AS signature
FIELDALIAS-reason = properties.status.failureReason AS reason
FIELDALIAS-authentication_service = properties.tokenIssuerType AS authentication_service
FIELDALIAS-vendor_account = tenantId AS vendor_account

# --- CIM EVAL Statements (new, not in default/) ---

# Authentication method (interactive vs non-interactive)
EVAL-authentication_method = case( \
    'properties.isInteractive'="true", "Interactive", \
    'properties.isInteractive'="false", "nonInteractive", \
    true(), "unknown")

# Destination type (always tenant for Entra ID)
EVAL-dest_type = "tenant"

# CIM status field (maps errorCode to success/failure)
EVAL-status = if('properties.status.errorCode'==0, "success", "failure")

# User agent string
EVAL-user_agent = 'properties.userAgent'

# Display name of user
EVAL-user_name = 'properties.userDisplayName'

# Signature ID (result code)
EVAL-signature_id = resultType

# Source user (normalized lowercase UPN)
EVAL-src_user = lower('properties.userPrincipalName')

# User type (ServicePrincipal vs User)
EVAL-user_type = case( \
    isnotnull('properties.servicePrincipalId') AND 'properties.servicePrincipalId'!="", "ServicePrincipal", \
    true(), "User")

# Device/virtual controller
EVAL-dvc = "Azure AD"

# Response time (ms to seconds)
EVAL-response_time = 'properties.processingTimeInMilliseconds'/1000

# --- Lookups ---

# Dataset classification from operationName + category
LOOKUP-dataset = mscs_aad_audit_authentication_lookup operationName category OUTPUTNEW dataset_name

# Risk severity from risk level
LOOKUP-severity_type = mscs_aad_severity_type_lookup properties.riskLevel OUTPUTNEW severity type


##############################################################################################################
# ENTRA ID Audit - CIM Field Enrichment (Phase 4)
# Source: Splunk_TA_microsoft-cloudservices v5.x (Splunkbase #3110)
# default/ has: FIELDALIAS-user(identity), FIELDALIAS-src(callerIpAddress), FIELDALIAS-action(operationName),
#               EVAL-vendor_product, EVAL-app, EVAL-action, EVAL-result
# This stanza adds NEW FIELDALIAS + EVAL + LOOKUP attributes only.
##############################################################################################################

[FAKE:azure:aad:audit]

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-src_ip = callerIpAddress AS src_ip
FIELDALIAS-signature = operationName AS signature
FIELDALIAS-command = operationName AS command
FIELDALIAS-dest = tenantId AS dest
FIELDALIAS-vendor_account = tenantId AS vendor_account

# --- CIM EVAL Statements (new, not in default/) ---

# Destination type
EVAL-dest_type = "tenant"

# CIM status (maps properties.result to success/failure)
EVAL-status = case('properties.result'=="success", "success", true(), "failure")

# Device/virtual controller
EVAL-dvc = coalesce('properties.loggedByService', "Azure AD")

# CIM Change object (target resource display name)
EVAL-object = coalesce(mvindex('properties.targetResources{}.displayName', 0), operationName)

# CIM object_id (target resource ID)
EVAL-object_id = mvindex('properties.targetResources{}.id', 0)

# CIM object_category (target resource type)
EVAL-object_category = mvindex('properties.targetResources{}.type', 0)

# CIM object_attrs (modified property name)
EVAL-object_attrs = mvindex('properties.targetResources{}.modifiedProperties{}.displayName', 0)

# CIM src_user (who initiated the change: user UPN or app name)
EVAL-src_user = coalesce('properties.initiatedBy.user.userPrincipalName', 'properties.initiatedBy.app.displayName')

# CIM src_user_name (human-readable name of initiator)
EVAL-src_user_name = coalesce('properties.initiatedBy.user.displayName', 'properties.initiatedBy.app.displayName')

# CIM src_user_type (principal type of initiator)
EVAL-src_user_type = case( \
    isnotnull('properties.initiatedBy.user.userPrincipalName'), "userPrincipal", \
    isnotnull('properties.initiatedBy.app.servicePrincipalName'), "servicePrincipal", \
    true(), "unknown")

# CIM user_name (target resource — who was acted upon)
EVAL-user_name = mvindex('properties.targetResources{}.displayName', 0)

# --- Lookups ---

# Change classification from operationName
LOOKUP-change_analysis = mscs_aad_change_analysis_lookup operationName OUTPUTNEW change_type action object_category


##############################################################################################################
# ENTRA ID Risk Detection - CIM Field Enrichment (Phase 4)
# Source: Splunk_TA_microsoft-cloudservices v5.x (Splunkbase #3110)
# default/ has: FIELDALIAS-src(callerIpAddress), EVAL-vendor_product, EVAL-app,
#               EVAL-action, EVAL-result, EVAL-severity, EVAL-user, EVAL-user_id
# This stanza adds NEW FIELDALIAS + EVAL attributes only.
##############################################################################################################

[FAKE:azure:aad:riskDetection]

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-src_ip = callerIpAddress AS src_ip
FIELDALIAS-signature = operationName AS signature
FIELDALIAS-dest = tenantId AS dest
FIELDALIAS-vendor_account = tenantId AS vendor_account

# --- CIM EVAL Statements (new, not in default/) ---

# Destination type
EVAL-dest_type = "tenant"

# Device/virtual controller
EVAL-dvc = "Azure AD"

# CIM description (risk state + risk type concatenation)
EVAL-description = 'properties.riskState' . " - " . 'properties.riskType'

# CIM signature_id (risk event type identifier)
EVAL-signature_id = 'properties.riskEventType'

# Display name of affected user
EVAL-user_name = 'properties.userDisplayName'

# CIM type (maps risk level to alert classification)
EVAL-type = case( \
    'properties.riskLevel'=="high", "alarm", \
    'properties.riskLevel'=="medium", "alert", \
    true(), "event")


##############################################################################################################
# MICROSOFT 365 Unified Audit Log - CIM Field Enrichment (Phase 5)
# Source: splunk_ta_o365 v5.1.0 (Splunkbase)
# default/ has: FIELDALIAS (user=UserId, src=ClientIP, action=Operation, object=SourceFileName,
#               file_name=SourceFileName, file_path=ObjectId, app=Workload), EVAL-vendor_product
# This stanza adds NEW FIELDALIAS + EVAL + LOOKUP attributes only.
# LOOKUPs populate dataset_name for eventtype classification (see local/eventtypes.conf).
##############################################################################################################

[FAKE:o365:management:activity]

# --- Lookups for dataset classification ---
# These populate dataset_name which eventtypes filter on (data_access, all_changes, etc.)
# OUTPUTNEW prevents overwriting fields already set by other lookups
LOOKUP-o365_change = splunk_ta_o365_cim_change_analysis Workload Operation OUTPUTNEW dataset_name action change_type object_category
LOOKUP-o365_data_access = splunk_ta_o365_cim_data_access Workload Operation OUTPUTNEW dataset_name action object_category
LOOKUP-o365_authentication = splunk_ta_o365_cim_authentication Workload Operation OUTPUTNEW dataset_name
LOOKUP-o365_auth_result = splunk_ta_o365_cim_authentication_ResultStatus ResultStatus OUTPUTNEW action
LOOKUP-o365_record_type = splunk_ta_o365_cim_authentication_RecordType RecordType OUTPUTNEW record_type RecordTypeDescription
LOOKUP-o365_alerts = splunk_ta_o365_cim_alerts Workload Operation OUTPUTNEW dataset_name

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-o365_vendor_account = OrganizationId AS vendor_account
FIELDALIAS-o365_command = Operation AS command
FIELDALIAS-o365_src_name = ClientIP AS src_name

# --- CIM EVAL Statements (new, not in default/) ---

# Destination (site URL, team name, or object path)
EVAL-dest = coalesce('SiteUrl', 'TeamName', 'ObjectId')

# Destination name (human-readable)
EVAL-dest_name = coalesce('SiteUrl', 'TeamName')

# Source user (normalized lowercase)
EVAL-src_user = lower('UserId')

# User type classification
EVAL-user_type = case( \
    UserType==0, "User", \
    UserType==2, "Admin", \
    UserType==3, "System", \
    UserType==4, "Application", \
    true(), "Unknown")

# CIM status field
EVAL-status = case( \
    ResultStatus=="Succeeded" OR ResultStatus=="Success" OR ResultStatus=="PartiallySucceeded" OR ResultStatus=="Allowed", "success", \
    ResultStatus=="Failed", "failure", \
    true(), lower(ResultStatus))

# CIM result field
EVAL-result = case( \
    ResultStatus=="Succeeded" OR ResultStatus=="Success" OR ResultStatus=="Allowed", "allowed", \
    ResultStatus=="Failed", "blocked", \
    true(), lower(ResultStatus))

# Object ID (primary resource identifier)
EVAL-object_id = coalesce('ObjectId', 'Id')

# Object attributes (operation name as descriptor)
EVAL-object_attrs = 'Operation'

# CIM signature (operation performed)
EVAL-signature = 'Operation'

# CIM signature_id (record type code)
EVAL-signature_id = 'RecordType'

# Category (workload name)
EVAL-category = 'Workload'

# Device/virtual controller
EVAL-dvc = "Microsoft Office 365"

# File size (if available in event)
EVAL-file_size = if(isnotnull('ItemSize'), 'ItemSize', null())


##############################################################################################################
# EXCHANGE MESSAGE TRACE - CIM Field Enrichment (Phase 5)
# Source: splunk_ta_o365 v5.1.0 (Splunkbase)
# default/ has: FIELDALIAS (recipient, src_user, dest, src, message_id, subject, size,
#               internal_message_id, status_code), EVAL (vendor_product, recipient_count),
#               LOOKUP (messagetrace_action), REPORT (domain extractions)
# This stanza adds NEW FIELDALIAS + EVAL attributes only.
##############################################################################################################

[FAKE:ms:o365:reporting:messagetrace]

# --- CIM Field Aliases (new, not in default/) ---
FIELDALIAS-o365_mt_vendor_account = Organization AS vendor_account

# --- CIM EVAL Statements (new, not in default/) ---

# Source user display name
EVAL-src_user_name = 'SenderAddress'

# Original sender
EVAL-orig_src = 'SenderAddress'

# File size (message size in bytes)
EVAL-file_size = 'Size'

# Original recipient
EVAL-orig_recipient = 'RecipientAddress'

# CIM status field
EVAL-status = case( \
    Status=="Delivered", "success", \
    Status=="FilteredAsSpam" OR Status=="Quarantined", "blocked", \
    Status=="Failed", "failure", \
    true(), "unknown")

# Device/virtual controller
EVAL-dvc = "Microsoft Exchange Online"


##############################################################################################################
# LINUX (Splunk_TA_nix) - CIM Field Enrichment (Phase 7)
# Source: Splunk_TA_nix (Splunkbase #833)
# Adds CIM fields for Performance (OS), Inventory, and Authentication data models.
# Our generators use KV_MODE=auto, so fields like pctUser, memTotalMB are auto-extracted.
# Only CIM-standard field name aliases/evals are added here.
# No complex coalesce chains needed (generator produces Linux-only, consistent field names).
##############################################################################################################

[FAKE:cpu]

# CIM src field (real TA maps host to src for performance model)
FIELDALIAS-src_for_cpu = host AS src

# CIM Performance field names (maps our generator field names to CIM standard)
EVAL-PercentIdleTime = pctIdle
EVAL-PercentUserTime = pctUser
EVAL-PercentSystemTime = pctSystem
EVAL-PercentWaitTime = pctIOWait
EVAL-cpu_user_percent = pctUser


[FAKE:vmstat]

# CIM src field
FIELDALIAS-src_for_vmstat = host AS src

# CIM Memory Performance fields
# Our fields: memTotalMB, memUsedMB, memFreeMB, memCachedMB, pctUsed
EVAL-mem = memTotalMB
EVAL-mem_free = memFreeMB
EVAL-mem_used = memUsedMB
EVAL-mem_free_percent = round(100 - pctUsed, 1)

# Legacy CIM fields (some dashboards/reports use these)
EVAL-FreeMBytes = memFreeMB
EVAL-UsedMBytes = memUsedMB
EVAL-TotalMBytes = memTotalMB
EVAL-UsedBytes = memUsedMB * 1048576


[FAKE:df]

# CIM src field
FIELDALIAS-src_for_df = host AS src

# CIM Storage Performance fields (convert GB to MB for CIM standard)
# Our fields: TotalGB, UsedGB, AvailGB, UsedPct
EVAL-storage = TotalGB * 1024
EVAL-storage_free = AvailGB * 1024
EVAL-storage_used = UsedGB * 1024
EVAL-storage_free_percent = round(100 - UsedPct, 1)

# Legacy CIM fields
EVAL-FreeMBytes = AvailGB * 1024
EVAL-TotalMBytes = TotalGB * 1024
EVAL-UsedMBytes = UsedGB * 1024
EVAL-PercentUsedSpace = UsedPct
EVAL-PercentFreeSpace = round(100 - UsedPct, 1)


[FAKE:iostat]

# CIM src field
FIELDALIAS-src_for_iostat = host AS src

# CIM I/O Performance fields
# Our fields: device, rkB_s, wkB_s, await, pctUtil
EVAL-mount = device
EVAL-read_ops = rkB_s
EVAL-write_ops = wkB_s
EVAL-latency = await
EVAL-total_ops = rkB_s + wkB_s


[FAKE:interfaces]

# CIM Inventory fields
EVAL-enabled = "true"
EVAL-speed = "1000"


[FAKE:linux:auth]

# CIM dvc field (host where auth occurred)
FIELDALIAS-dvc_for_auth = host AS dvc

# CIM dest (the target host for authentication)
EVAL-dest = host

# CIM app (process name as application identifier)
EVAL-app = process

# CIM action field (maps event type to CIM-standard success/failure/executed)
# Covers all 6 event patterns from our generator:
#   SSH accepted (publickey/password) -> success
#   SSH failed -> failure
#   sudo (successful execution) -> executed
#   CRON (job execution) -> executed
#   systemd (service start/stop/reload) -> success
#   systemd-logind (session open/close) -> success
EVAL-action = case( \
    match(_raw, "Accepted\s+(publickey|password)"), "success", \
    match(_raw, "Failed\s+password"), "failure", \
    match(_raw, "sudo:"), "executed", \
    match(_raw, "CRON\["), "executed", \
    match(_raw, "systemd\["), "success", \
    match(_raw, "systemd-logind\["), "success", \
    true(), "unknown")

# CIM status field
EVAL-status = case( \
    match(_raw, "Accepted"), "success", \
    match(_raw, "Failed"), "failure", \
    true(), "success")

# CIM authentication_method (SSH key type or password)
EVAL-authentication_method = case( \
    match(_raw, "publickey"), "publickey", \
    match(_raw, "password"), "password", \
    true(), null())

# CIM object_category
EVAL-object_category = case( \
    process=="sshd", "session", \
    process=="sudo", "command", \
    process=="CRON", "job", \
    match(_raw, "systemd-logind"), "session", \
    match(_raw, "systemd\["), "service", \
    true(), null())

# CIM user_role (privilege detection from sudo USER=root)
EVAL-user_role = case( \
    match(_raw, "USER=root"), "admin", \
    true(), null())


##############################################################################################################
# SERVICENOW (Splunk_TA_snow) - CIM Field Enrichment (Phase 8)
# Source: Splunk_TA_snow (Splunkbase)
# Adds CIM fields for Ticket Management and Inventory data models.
# Key difference: Our generator uses human-readable values directly (state="In Progress",
# assignment_group="Service Desk"), not numeric codes + dv_* display fields.
# This means we alias from plain fields instead of dv_* fields.
##############################################################################################################

[FAKE:servicenow:incident]

# --- CIM Field Aliases (new -- names differ from default/ to avoid collision) ---

# Real TA: short_description AS incident (for CIM Incident data model)
FIELDALIAS-incident = short_description AS incident

# Real TA: severity AS severity_id
FIELDALIAS-severity_id = priority AS severity_id

# Real TA: dv_assignment_group AS assignment_group_name (we use plain field)
FIELDALIAS-assignment_group_name = assignment_group AS assignment_group_name

# Real TA: dv_state AS incident_state_name (we use plain state field)
FIELDALIAS-incident_state_name = state AS incident_state_name

# Real TA: dv_cmdb_ci AS affect_dest (we use plain cmdb_ci field)
FIELDALIAS-affect_dest = cmdb_ci AS affect_dest

# Real TA: dv_assigned_to AS assignment_user_name
FIELDALIAS-assignment_user_name = assigned_to_name AS assignment_user_name

# Real TA: dv_caller_id AS name
FIELDALIAS-name = caller_name AS name

# --- CIM EVAL Statements (new, not in default/) ---

# CIM dest (real TA uses endpoint AS dest; we use cmdb_ci)
EVAL-dest = cmdb_ci

# CIM src_user (real TA uses sys_created_by; we use caller_id email)
EVAL-src_user = caller_id

# CIM time_submitted (real TA uses sys_created_on)
EVAL-time_submitted = sys_updated_on

# Severity name from priority (inline case instead of lookup -- numbering differs from real TA)
EVAL-severity_name = case( \
    priority==1, "Critical", \
    priority==2, "High", \
    priority==3, "Moderate", \
    priority==4, "Low", \
    priority==5, "Planning", \
    true(), "Unknown")


[FAKE:servicenow:change]

# --- CIM Field Aliases (new, not in default/) ---

# Real TA: short_description AS description
FIELDALIAS-description_chg = short_description AS description

# Real TA: short_description AS change (CIM Change data model)
FIELDALIAS-change = short_description AS change

# Real TA: dv_assignment_group AS assignment_group_name
FIELDALIAS-assignment_group_name_chg = assignment_group AS assignment_group_name

# Real TA: dv_assigned_to AS user
FIELDALIAS-user_chg = assigned_to AS user

# Real TA: dv_cmdb_ci AS affect_dest
FIELDALIAS-affect_dest_chg = cmdb_ci AS affect_dest

# Real TA: dv_state AS change_state_name
FIELDALIAS-change_state_name = state AS change_state_name

# --- CIM EVAL Statements (new, not in default/) ---

# CIM dest (from cmdb_ci)
EVAL-dest = cmdb_ci

# CIM src_user (from requested_by)
EVAL-src_user = requested_by

# CIM time_submitted
EVAL-time_submitted = sys_updated_on


[FAKE:servicenow:cmdb]

# --- CIM Inventory Field Aliases ---
FIELDALIAS-dest = name AS dest
FIELDALIAS-ip = ip_address AS ip
FIELDALIAS-serial = serial_number AS serial
FIELDALIAS-dns = fqdn AS dns


##############################################################################################################
# Phase 10: CISCO CATALYST IOS-XE (Syslog) -- CIM Alignment
# Source: TA_cisco_catalyst (Splunkbase)
# CIM models: Authentication, Change, Network Traffic
##############################################################################################################

[FAKE:cisco:ios]

# Disable auto KV extraction (syslog format, not key-value)
KV_MODE = none

# REPORT transform: Extract facility, severity_id, mnemonic, message_text from IOS syslog
# Example: <189>10998: CAT-BOS-DIST-02: Jan 31 2026 23:25:34.755: %AUTHMGR-5-START: Starting 'dot1x'...
# Extracts: facility=AUTHMGR, severity_id=5, mnemonic=START, message_text=Starting 'dot1x'...
REPORT-0fake_cisco_ios_general = extract_fake_cisco_ios_general

# Severity lookup: severity_id (0-7) -> CIM severity (critical/high/medium/low/informational)
LOOKUP-fake_cisco_ios_severity = fake_cisco_ios_severity_lookup severity_id OUTPUT severity severity_name severity_id_and_name severity_description

# Action lookup: vendor_action -> CIM action (allowed/blocked/failure/success/modified)
LOOKUP-fake_cisco_ios_action = fake_cisco_ios_actions_lookup vendor_action OUTPUT action type change_type

# --- CIM EVAL Statements ---

EVAL-vendor = "Cisco"
EVAL-product = "IOS"
EVAL-dvc = host

# Map mnemonic to vendor_action for the action lookup
# The lookup then maps vendor_action -> CIM action
EVAL-vendor_action = case( \
    mnemonic=="UPDOWN" AND match(message_text,"changed state to up"), "up", \
    mnemonic=="UPDOWN" AND match(message_text,"changed state to down"), "down", \
    mnemonic=="UPDOWN" AND match(message_text,"administratively down"), "administratively down", \
    mnemonic=="UPDOWN" AND match(message_text,"administratively up"), "administratively up", \
    mnemonic=="LOGIN_SUCCESS", "success", \
    mnemonic=="LOGIN_FAILED", "failed", \
    mnemonic=="PRIV_I" OR mnemonic=="PRIV_AUTH_PASS", "succeeded", \
    mnemonic=="PRIV_AUTH_FAIL", "failed", \
    mnemonic IN("SUCCESS","PASS"), "succeeded", \
    mnemonic=="FAIL", "failed", \
    mnemonic=="START", "Start", \
    mnemonic=="RELOAD", "Reload requested", \
    mnemonic=="RESTART", "System restarted", \
    mnemonic=="SWITCH_ADDED", "joined", \
    mnemonic=="SWITCH_REMOVED", "left", \
    mnemonic=="ERR_DISABLE" OR mnemonic=="IF_DOWN_ERROR_DISABLED", "err-disable", \
    1==1, mnemonic)

# CIM dest: For authentication events, dest is the switch itself
EVAL-dest = if(facility IN("DOT1X","MAB","AUTHMGR","SESSION_MGR") OR mnemonic IN("LOGIN_SUCCESS","LOGIN_FAILED","SSH2_USERAUTH"), host, null())


##############################################################################################################
# Phase 10: CISCO ACI - Faults -- CIM Alignment
# No separate ACI TA exists; custom CIM mapping for ACI JSON events
# CIM models: Alert
##############################################################################################################

[FAKE:cisco:aci:fault]

# --- CIM EVAL Statements ---
EVAL-vendor = "Cisco"
EVAL-product = "ACI"

# Map ACI severity to CIM severity
EVAL-severity = case( \
    'faultInst.attributes.severity'=="critical", "critical", \
    'faultInst.attributes.severity'=="major", "high", \
    'faultInst.attributes.severity'=="minor", "medium", \
    'faultInst.attributes.severity'=="warning", "low", \
    'faultInst.attributes.severity'=="cleared", "informational", \
    1==1, "informational")

EVAL-signature = 'faultInst.attributes.code'
EVAL-description = 'faultInst.attributes.descr'
EVAL-type = "alert"
EVAL-object = 'faultInst.attributes.dn'
EVAL-object_category = 'faultInst.attributes.type'
EVAL-subject = 'faultInst.attributes.subject'
EVAL-cause = 'faultInst.attributes.cause'
EVAL-dvc = host

# ACI fault code enrichment (vendor explanation + recommended action)
LOOKUP-fake_aci_fault_codes = fake_cisco_ios_aci_fault_codes_lookup fault_code AS faultInst.attributes.code OUTPUT vendor_explanation vendor_recommended_action


##############################################################################################################
# Phase 10: CISCO ACI - Events -- CIM Alignment
# CIM models: Change, Network
##############################################################################################################

[FAKE:cisco:aci:event]

# --- CIM EVAL Statements ---
EVAL-vendor = "Cisco"
EVAL-product = "ACI"

# Map ACI severity to CIM severity
EVAL-severity = case( \
    'eventRecord.attributes.severity'=="critical", "critical", \
    'eventRecord.attributes.severity'=="major", "high", \
    'eventRecord.attributes.severity'=="minor", "medium", \
    'eventRecord.attributes.severity'=="warning", "low", \
    1==1, "informational")

EVAL-description = 'eventRecord.attributes.descr'
EVAL-object = 'eventRecord.attributes.affected'
EVAL-cause = 'eventRecord.attributes.cause'

# CIM action (created/modified/deleted)
EVAL-action = case( \
    'eventRecord.attributes.ind'=="creation", "created", \
    'eventRecord.attributes.ind'=="modification", "modified", \
    'eventRecord.attributes.ind'=="deletion", "deleted", \
    1==1, 'eventRecord.attributes.ind')

# CIM change_type (create/update/delete)
EVAL-change_type = case( \
    'eventRecord.attributes.ind'=="creation", "create", \
    'eventRecord.attributes.ind'=="modification", "update", \
    'eventRecord.attributes.ind'=="deletion", "delete", \
    1==1, 'eventRecord.attributes.ind')

EVAL-dvc = host
EVAL-user = if('eventRecord.attributes.user'!="", 'eventRecord.attributes.user', null())


##############################################################################################################
# Phase 10: CISCO ACI - Audit -- CIM Alignment
# CIM models: Change (audit)
##############################################################################################################

[FAKE:cisco:aci:audit]

# --- CIM EVAL Statements ---
EVAL-vendor = "Cisco"
EVAL-product = "ACI"

EVAL-user = 'aaaModLR.attributes.user'
EVAL-object = 'aaaModLR.attributes.affected'
EVAL-object_category = 'aaaModLR.attributes.changeSet'
EVAL-description = 'aaaModLR.attributes.descr'

# CIM action (created/modified/deleted)
EVAL-action = case( \
    'aaaModLR.attributes.ind'=="creation", "created", \
    'aaaModLR.attributes.ind'=="modification", "modified", \
    'aaaModLR.attributes.ind'=="deletion", "deleted", \
    1==1, 'aaaModLR.attributes.ind')

# CIM change_type (create/update/delete)
EVAL-change_type = case( \
    'aaaModLR.attributes.ind'=="creation", "create", \
    'aaaModLR.attributes.ind'=="modification", "update", \
    'aaaModLR.attributes.ind'=="deletion", "delete", \
    1==1, 'aaaModLR.attributes.ind')

EVAL-src_user = 'aaaModLR.attributes.user'
EVAL-dvc = host
EVAL-severity = "informational"
EVAL-status = "success"


##############################################################################################################
# Phase 11: CISCO SECURE ACCESS (Umbrella) - DNS -- CIM Alignment
# Source: TA-cisco-cloud-security-addon (Splunkbase)
# CIM models: Network Resolution (DNS)
# default/ has: REPORT (umbrella_dns_fields), FIELDALIAS (user, src, action, query, query_type,
#               reply_code, dest), EVAL (vendor_product, app)
# This stanza adds NEW FIELDALIAS + EVAL attributes only.
##############################################################################################################

[FAKE:cisco:umbrella:dns]

# Vendor/product (split fields for CIM)
EVAL-vendor = "Cisco"
EVAL-product = "Secure Access"

# Source IP alias
FIELDALIAS-dns_src_ip = InternalIp AS src_ip
FIELDALIAS-dns_src_external_ip = ExternalIp AS src_external_ip

# DNS record type normalization (our generator uses "1 (A)" format)
EVAL-record_type = case(QueryType=="1 (A)","A")
EVAL-query_type = case(QueryType=="1 (A)","A")

# Reply code to numeric ID (CIM Network Resolution)
EVAL-reply_code_id = case( \
    ResponseCode=="NOERROR",0, \
    ResponseCode=="SERVFAIL",2, \
    ResponseCode=="NXDOMAIN",3, \
    ResponseCode=="REFUSED",5, \
    1==1,null())

# Message type for DNS (always QUERY for our events)
EVAL-message_type = case(isnotnull(QueryType),"QUERY")

# Normalize action to lowercase (overrides default/ FIELDALIAS -- EVAL takes precedence)
EVAL-action = lower(Action)


##############################################################################################################
# Phase 11: CISCO SECURE ACCESS (Umbrella) - Proxy -- CIM Alignment
# Source: TA-cisco-cloud-security-addon (Splunkbase)
# CIM models: Web Proxy
# default/ has: REPORT (umbrella_proxy_fields), FIELDALIAS (user, src, action, url, dest,
#               http_method, status, bytes_in, bytes_out, http_content_type, http_user_agent),
#               EVAL (vendor_product, app)
# This stanza adds NEW EVAL attributes only.
##############################################################################################################

[FAKE:cisco:umbrella:proxy]

# Vendor/product (split fields for CIM)
EVAL-vendor = "Cisco"
EVAL-product = "Secure Access"

# Total bytes (CIM Web Proxy)
EVAL-bytes = Request_Size + Response_Size

# Normalize action to lowercase (overrides default/ FIELDALIAS -- EVAL takes precedence)
EVAL-action = lower(Action)

# HTTP user agent length (used by some security detections)
EVAL-http_user_agent_length = len(User_Agent)

# URL length (used by some security detections)
EVAL-url_length = len(URL)


##############################################################################################################
# Phase 11: CISCO SECURE ACCESS (Umbrella) - Cloud Firewall -- CIM Alignment
# Source: TA-cisco-cloud-security-addon (Splunkbase)
# CIM models: Network Traffic
# default/ has: REPORT (umbrella_firewall_fields), FIELDALIAS (src, dest, action, dest_port,
#               src_port, transport, direction), EVAL (vendor_product, app)
# This stanza adds NEW FIELDALIAS + EVAL attributes only.
##############################################################################################################

[FAKE:cisco:umbrella:firewall]

# Vendor/product (split fields for CIM)
EVAL-vendor = "Cisco"
EVAL-product = "Secure Access"

# Action normalization (Verdict -> CIM: allowed/blocked; overrides default/ FIELDALIAS)
EVAL-action = case(Verdict=="ALLOW","allowed",Verdict=="BLOCK","blocked")

# Direction normalization (overrides default/ FIELDALIAS)
EVAL-direction = lower(Direction)

# CIM bytes (ready for when generator adds these columns from real TA's 36-column format)
FIELDALIAS-bytes_in = Bytes_Received AS bytes_in
FIELDALIAS-bytes_out = Bytes_Sent AS bytes_out
FIELDALIAS-packets_in = Packets_Received AS packets_in
FIELDALIAS-packets_out = Packets_Sent AS packets_out
EVAL-bytes = Bytes_Received + Bytes_Sent
EVAL-packets = Packets_Received + Packets_Sent

# Protocol fields (IP_Protocol is numeric: 6=tcp, 17=udp, 1=icmp; overrides default/ FIELDALIAS)
EVAL-transport = case(IP_Protocol=="6","tcp",IP_Protocol=="17","udp",IP_Protocol=="1","icmp")
EVAL-protocol = case(isnotnull(IP_Protocol),"ip")
EVAL-protocol_version = if(match(coalesce(Source_IP,Destination_IP),":"), "ipv6", if(match(coalesce(Source_IP,Destination_IP), "(?:\\d+\\.\\d+\\.\\d+\\.\\d+)"),"ipv4", null))

# Source IP alias
FIELDALIAS-firewall_src_ip = Source_IP AS src_ip

# DVC
FIELDALIAS-dvc = host AS dvc


##############################################################################################################
# Phase 11: CISCO SECURE ACCESS (Umbrella) - Audit -- CIM Alignment
# Source: TA-cisco-cloud-security-addon (Splunkbase)
# CIM models: Change (Audit)
# default/ has: FIELDALIAS (user=Email, action=Action), EVAL (vendor_product, app)
# This stanza adds vendor/product split fields only.
##############################################################################################################

[FAKE:cisco:umbrella:audit]

# Vendor/product (split fields for CIM)
EVAL-vendor = "Cisco"
EVAL-product = "Secure Access"


##############################################################################################################
# Phase 12: CISCO WEBEX -- CIM Alignment
# No Supporting TA has CIM alignment; all mappings are custom based on actual event field structure.
# 8 sourcetypes covering: Inventory, Network Sessions, Change, Authentication, Performance
##############################################################################################################


##############################################################################################################
# Phase 12: CISCO WEBEX - Device Events -- CIM Alignment
# CIM models: Inventory / Performance
# default/ has: FIELDALIAS (action=event_type, dest=device_id), EVAL (vendor, product, vendor_product)
# This stanza adds device health, severity, and performance fields.
##############################################################################################################

[FAKE:cisco:webex:events]

# CIM Inventory / Performance fields
EVAL-dvc = device_id
EVAL-dvc_type = device_model
EVAL-status = overall_status
EVAL-description = description
EVAL-severity = case( \
    overall_status=="unhealthy", "high", \
    overall_status=="degraded", "medium", \
    overall_status=="healthy", "informational", \
    1==1, "informational")
EVAL-src_ip = 'network_status.ip_address'
EVAL-cpu_load_percent = 'system_metrics.cpu_usage_pct'


##############################################################################################################
# Phase 12: CISCO WEBEX - Meetings Usage History -- CIM Alignment
# CIM models: Network Sessions
# default/ has: EVAL (vendor, product, vendor_product) only
# This stanza adds user, session, and meeting fields.
##############################################################################################################

[FAKE:cisco:webex:meetings:history:meetingusagehistory]

# CIM Network Sessions fields
FIELDALIAS-user = hostEmail AS user
FIELDALIAS-user_name = hostName AS user_name
FIELDALIAS-session_id = confID AS session_id
FIELDALIAS-signature = confName AS signature
EVAL-dest = siteUrl
EVAL-session_duration = duration
EVAL-participant_count = totalParticipants


##############################################################################################################
# Phase 12: CISCO WEBEX - Meetings Attendee History -- CIM Alignment
# CIM models: Network Sessions
# default/ has: FIELDALIAS (user=participantEmail), EVAL (vendor, product, vendor_product)
# This stanza adds session, network, and app fields.
##############################################################################################################

[FAKE:cisco:webex:meetings:history:meetingattendeehistory]

# CIM Network Sessions fields
# Note: default/ has FIELDALIAS user=participantEmail but actual field is attendeeEmail
EVAL-user = attendeeEmail
FIELDALIAS-user_name = attendeeName AS user_name
FIELDALIAS-src_ip = ipAddress AS src_ip
FIELDALIAS-session_id = meetingKey AS session_id
FIELDALIAS-signature = confName AS signature
EVAL-dest = siteUrl
EVAL-app = clientType
EVAL-session_duration = duration


##############################################################################################################
# Phase 12: CISCO WEBEX - Meetings REST API -- CIM Alignment
# CIM models: Network Sessions
# default/ has: EVAL (vendor, product, vendor_product) only
# This stanza adds user, session, and meeting type fields.
##############################################################################################################

[FAKE:cisco:webex:meetings]

# CIM Network Sessions fields
FIELDALIAS-user = hostEmail AS user
FIELDALIAS-user_name = hostDisplayName AS user_name
FIELDALIAS-session_id = id AS session_id
FIELDALIAS-signature = title AS signature
EVAL-dest = siteUrl
EVAL-app = meetingType


##############################################################################################################
# Phase 12: CISCO WEBEX - Admin Audit Events -- CIM Alignment
# CIM models: Change (Audit)
# default/ has: EVAL (user=data.actorEmail, action=data.actionText, vendor, product, vendor_product)
# This stanza adds object, description, and change type fields.
##############################################################################################################

[FAKE:cisco:webex:admin:audit:events]

# CIM Change fields (user and action already in default/)
EVAL-object = 'data.targetId'
EVAL-object_category = resource
EVAL-description = 'data.eventDescription'
EVAL-src_user = 'data.actorEmail'
EVAL-status = "success"
EVAL-change_type = "update"


##############################################################################################################
# Phase 12: CISCO WEBEX - Security Audit Events -- CIM Alignment
# CIM models: Authentication
# default/ has: EVAL (vendor, product, vendor_product) only
# This stanza adds user, action, status, and authentication fields.
##############################################################################################################

[FAKE:cisco:webex:security:audit:events]

# CIM Authentication fields
EVAL-user = 'data.actorEmail'
EVAL-user_name = 'data.actorName'
EVAL-src_ip = 'data.actorIp'
EVAL-action = 'data.actionText'
EVAL-app = "Cisco Webex"
EVAL-http_user_agent = 'data.actorUserAgent'
EVAL-signature = 'data.eventCategory'
EVAL-status = case( \
    match('data.eventCategory',"^LOGINS$"), "success", \
    match('data.actionText',"logged out"), "success", \
    match('data.actionText',"logged in"), "success", \
    match('data.actionText',"failed"), "failure", \
    1==1, "success")
EVAL-action_name = case( \
    match('data.actionText',"logged in"), "success", \
    match('data.actionText',"logged out"), "success", \
    match('data.actionText',"failed"), "failure", \
    1==1, "success")


##############################################################################################################
# Phase 12: CISCO WEBEX - Meeting Quality Metrics -- CIM Alignment
# CIM models: Performance
# default/ has: EVAL (vendor, product, vendor_product) only
# This stanza adds user, session, and device fields. Nested QoS arrays (audioIn[], videoIn[])
# don't map cleanly to CIM Performance -- kept minimal.
##############################################################################################################

[FAKE:cisco:webex:meeting:qualities]

# CIM Performance fields
FIELDALIAS-user = webexUserEmail AS user
FIELDALIAS-user_name = webexUserName AS user_name
FIELDALIAS-src_ip = localIP AS src_ip
FIELDALIAS-session_id = meetingInstanceId AS session_id
EVAL-app = clientType
EVAL-os = osType
EVAL-dvc = hardwareType


##############################################################################################################
# Phase 12: CISCO WEBEX - Call Detailed History (CDR) -- CIM Alignment
# CIM models: Network Sessions
# default/ has: EVAL (vendor, product, vendor_product) only
# Note: Field names contain spaces (JSON keys like "Start time", "Called number").
##############################################################################################################

[FAKE:cisco:webex:call:detailed_history]

# CIM Network Sessions fields
EVAL-user = User
EVAL-src_user = 'Calling line ID'
EVAL-dest_user = 'Called line ID'
EVAL-src = 'Calling number'
EVAL-dest = 'Called number'
EVAL-direction = lower(Direction)
EVAL-duration = Duration
EVAL-session_id = 'Call ID'
EVAL-status = case( \
    'Call outcome'=="Success", "success", \
    'Call outcome'=="Voicemail", "success", \
    'Call outcome'=="Missed", "failure", \
    'Call outcome'=="Declined", "failure", \
    1==1, lower('Call outcome'))
EVAL-result = 'Call outcome'
EVAL-app = 'Client type'
EVAL-signature = 'Call type'


##############################################################################################################
# Phase 13: CISCO CATALYST CENTER -- CIM Alignment
# No Supporting TA exists. All mappings are custom based on actual Catalyst Center API field structure.
# 4 sourcetypes covering: Inventory, Performance, Alert
##############################################################################################################


##############################################################################################################
# Phase 13: CISCO CATALYST CENTER - Device Health -- CIM Alignment
# CIM models: Inventory / Performance
# default/ has: FIELDALIAS (dest=name, cpu_load_percent=cpuUtilization, mem_used_percent=memoryUtilization),
#               EVAL (vendor_product, app)
# This stanza adds dvc, dvc_type, src_ip, os, status, severity fields.
##############################################################################################################

[FAKE:cisco:catalyst:devicehealth]

# CIM Inventory / Performance fields
EVAL-vendor = "Cisco"
EVAL-product = "Catalyst Center"
FIELDALIAS-dvc = name AS dvc
FIELDALIAS-dvc_type = deviceType AS dvc_type
FIELDALIAS-src_ip = ipAddress AS src_ip
EVAL-os = "IOS-XE ".osVersion
EVAL-status = case( \
    reachabilityHealth=="REACHABLE" AND overallHealth>=7, "healthy", \
    reachabilityHealth=="REACHABLE" AND overallHealth>=4, "degraded", \
    reachabilityHealth=="REACHABLE" AND overallHealth<4, "unhealthy", \
    1==1, "unreachable")
EVAL-severity = case( \
    overallHealth>=8, "informational", \
    overallHealth>=5, "medium", \
    overallHealth>=1, "high", \
    1==1, "critical")


##############################################################################################################
# Phase 13: CISCO CATALYST CENTER - Network Health -- CIM Alignment
# CIM models: Performance
# default/ has: EVAL (vendor_product, app) only
# This stanza adds status and severity derived from healthScore.
##############################################################################################################

[FAKE:cisco:catalyst:networkhealth]

# CIM Performance fields
EVAL-vendor = "Cisco"
EVAL-product = "Catalyst Center"
EVAL-status = case( \
    healthScore>=80, "healthy", \
    healthScore>=50, "degraded", \
    1==1, "unhealthy")
EVAL-severity = case( \
    healthScore>=80, "informational", \
    healthScore>=50, "medium", \
    1==1, "high")


##############################################################################################################
# Phase 13: CISCO CATALYST CENTER - Client Health -- CIM Alignment
# CIM models: Performance
# default/ has: EVAL (vendor_product, app) only
# Deeply nested arrays (scoreDetail{}). Minimal CIM mapping.
##############################################################################################################

[FAKE:cisco:catalyst:clienthealth]

# CIM Performance fields
EVAL-vendor = "Cisco"
EVAL-product = "Catalyst Center"
EVAL-dest = siteId


##############################################################################################################
# Phase 13: CISCO CATALYST CENTER - Issues -- CIM Alignment
# CIM models: Alert
# default/ has: FIELDALIAS (signature=issueName, severity=issueSeverity, description=issueDescription),
#               EVAL (vendor_product, app)
# This stanza adds type, id, urgency, dest, body fields.
##############################################################################################################

[FAKE:cisco:catalyst:issue]

# CIM Alert fields
EVAL-vendor = "Cisco"
EVAL-product = "Catalyst Center"
EVAL-type = issueCategory
EVAL-id = issueId
EVAL-urgency = case( \
    issuePriority=="P1", "critical", \
    issuePriority=="P2", "high", \
    issuePriority=="P3", "medium", \
    issuePriority=="P4", "low", \
    1==1, "informational")
EVAL-dest = issueEntityValue
EVAL-body = issueSummary


##############################################################################################################
# Phase 14: MERAKI HEALTH / IoT -- CIM Alignment
# No Supporting TA has CIM for health metrics, sensor readings, or camera analytics.
# All mappings are custom based on actual event field structure.
# 4 sourcetypes covering: Performance, Inventory, IoT, Physical Security
##############################################################################################################


##############################################################################################################
# Phase 14: MERAKI - Switch Health -- CIM Alignment
# CIM models: Performance / Inventory
# default/ has: FIELDALIAS (meraki_event_type=type), EVAL (vendor, product, vendor_product)
# This stanza adds port-level fields: dvc, interface, status, speed, duplex.
##############################################################################################################

[FAKE:meraki:switches:health]

# CIM Performance / Inventory fields
EVAL-dvc = deviceName
EVAL-dvc_type = deviceModel
EVAL-interface = 'eventData.portId'
EVAL-status = case( \
    'eventData.status'=="Connected", "up", \
    'eventData.status'=="Disconnected", "down", \
    1==1, lower('eventData.status'))
EVAL-speed = 'eventData.speed'
EVAL-duplex = 'eventData.duplex'
EVAL-description = description


##############################################################################################################
# Phase 14: MERAKI - Access Point Health -- CIM Alignment
# CIM models: Performance
# default/ has: FIELDALIAS (meraki_event_type=type), EVAL (vendor, product, vendor_product)
# This stanza adds wireless metrics: rssi, snr, channel utilization, health score.
##############################################################################################################

[FAKE:meraki:accesspoints:health]

# CIM Performance fields
EVAL-dvc = deviceName
EVAL-dvc_type = deviceModel
EVAL-description = description
EVAL-rssi = 'eventData.signalQuality.rssi'
EVAL-snr = 'eventData.signalQuality.snr'
EVAL-channel_utilization = 'eventData.channelUtilization.utilizationTotal'
EVAL-health_score = 'eventData.healthScore.performance'
EVAL-client_count = 'eventData.clientCount'
EVAL-dest = area


##############################################################################################################
# Phase 14: MERAKI - Sensors (IoT) -- CIM Alignment
# CIM models: Change / IoT
# default/ has: FIELDALIAS (meraki_event_type=type), EVAL (vendor, product, vendor_product)
# This stanza adds sensor identity, action, metric, and reading fields.
##############################################################################################################

[FAKE:meraki:sensors]

# CIM IoT / Change fields
EVAL-dvc = deviceName
EVAL-dvc_type = 'sensor.model'
EVAL-location = 'sensor.name'
EVAL-action = case( \
    type=="door_open", "open", \
    type=="door_close", "close", \
    type=="water_detected", "detected", \
    type=="water_clear", "cleared", \
    type=="sensor_reading", "reading", \
    1==1, type)
EVAL-metric_name = 'trigger.metric'
EVAL-temperature = 'trigger.temperature.celsius'
EVAL-humidity = 'trigger.humidity.value'
EVAL-description = description


##############################################################################################################
# Phase 14: MERAKI - Cameras (Physical Security) -- CIM Alignment
# CIM models: Change / Physical Security
# default/ has: FIELDALIAS (meraki_event_type=type), EVAL (vendor, product, vendor_product)
# This stanza adds zone, people count, and camera status fields.
##############################################################################################################

[FAKE:meraki:cameras]

# CIM Physical Security / Change fields
EVAL-dvc = deviceName
EVAL-dvc_type = deviceModel
EVAL-action = type
EVAL-zone = 'eventData.zone'
EVAL-people_count = 'eventData.people_count'
EVAL-description = description
EVAL-status = case( \
    type=="health_status", 'eventData.status', \
    type=="motion_detected", "detected", \
    type=="person_detected", "detected", \
    type=="analytics", "reporting", \
    1==1, null())
